const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bx4vd2Fq.js","assets/react-core-CO7gc3IH.js","assets/semi-ui-bJlM6mS0.js","assets/semi-ui-pvaXLnjT.css","assets/tools-0z3stafu.js","assets/react-components-a9KBSWOA.js","assets/semantic-COJqu6ew.js","assets/index-CMNanNip.js","assets/visactor-BRK7MFL5.js","assets/index-Cvi4v8_m.js"])))=>i.map(i=>d[i]);
import{r as t,a as yt,u as Re,N as Dt,L as cu,R as pu,e as Ou,c as Bt,g as At,f as bt,h as St,i as wt,j as ge,B as _t}from"./react-core-CO7gc3IH.js";import{S as Ae,T as Pe,e as z,f as mu,g as tu,h as de,B as T,F as le,i as ue,j as Me,D as Du,M as ye,k as N,l as nu,m as $e,P as ve,L as ce,I as Xu,C as we,n as iu,o as vt,R as Ee,p as he,q as Ue,r as Tu,A as zu,s as Ge,t as kt,u as Tt,v as It,w as _u,x as He,y as Iu,z as et,E as Ve,G as ut,H as Pt,J as Pu,K as du,N as Wu,O as Mt,Q as tt,U as nt,V as $t,W as Rt,X as eu,Y as st,Z as at,$ as Ot,a0 as zt,a1 as Lt,a2 as Nt,a3 as Wt,a4 as Ut,a5 as Kt,a6 as Gt,a7 as Ht,a8 as qt}from"./semi-ui-bJlM6mS0.js";import{c as Vt,a as rt}from"./tools-0z3stafu.js";import{Q as Qt,_ as ou,T as it,f as vu,k as Jt}from"./react-components-a9KBSWOA.js";import{G as Qe,H as De,I as Lu,F as G,S as bu,B as uu,M as Bu,D as _e,a as Cu,b as Yt,L as Zt}from"./semantic-COJqu6ew.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();var lt={exports:{}},Su={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xt=t,en=Symbol.for("react.element"),un=Symbol.for("react.fragment"),tn=Object.prototype.hasOwnProperty,nn=Xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sn={key:!0,ref:!0,__self:!0,__source:!0};function ot(u,n,i){var s,r={},a=null,h=null;i!==void 0&&(a=""+i),n.key!==void 0&&(a=""+n.key),n.ref!==void 0&&(h=n.ref);for(s in n)tn.call(n,s)&&!sn.hasOwnProperty(s)&&(r[s]=n[s]);if(u&&u.defaultProps)for(s in n=u.defaultProps,n)r[s]===void 0&&(r[s]=n[s]);return{$$typeof:en,type:u,key:a,ref:h,props:r,_owner:nn.current}}Su.Fragment=un;Su.jsx=ot;Su.jsxs=ot;lt.exports=Su;var e=lt.exports,Mu={},Uu=yt;Mu.createRoot=Uu.createRoot,Mu.hydrateRoot=Uu.hydrateRoot;const an="modulepreload",rn=function(u){return"/"+u},Ku={},Nu=function(n,i,s){let r=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),h=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.all(i.map(y=>{if(y=rn(y),y in Ku)return;Ku[y]=!0;const w=y.endsWith(".css"),d=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${d}`))return;const l=document.createElement("link");if(l.rel=w?"stylesheet":an,w||(l.as="script",l.crossOrigin=""),l.href=y,h&&l.setAttribute("nonce",h),document.head.appendChild(l),w)return new Promise((F,x)=>{l.addEventListener("load",F),l.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${y}`)))})}))}return r.then(()=>n()).catch(a=>{const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=a,window.dispatchEvent(h),!h.defaultPrevented)throw a})},Be=({prompt:u="page"})=>e.jsxs(Ae,{style:{height:100},spinning:!0,children:["加载",u,"中..."]}),ln=Vt(),Fe=10,yu=[{key:1,text:"OpenAI",value:1,color:"green",label:"OpenAI"},{key:2,text:"Midjourney Proxy",value:2,color:"light-blue",label:"Midjourney Proxy"},{key:5,text:"Midjourney Proxy Plus",value:5,color:"blue",label:"Midjourney Proxy Plus"},{key:4,text:"Ollama",value:4,color:"grey",label:"Ollama"},{key:14,text:"Anthropic Claude",value:14,color:"indigo",label:"Anthropic Claude"},{key:33,text:"AWS Claude",value:33,color:"indigo",label:"AWS Claude"},{key:3,text:"Azure OpenAI",value:3,color:"teal",label:"Azure OpenAI"},{key:24,text:"Google Gemini",value:24,color:"orange",label:"Google Gemini"},{key:34,text:"Cohere",value:34,color:"purple",label:"Cohere"},{key:15,text:"百度文心千帆",value:15,color:"blue",label:"百度文心千帆"},{key:17,text:"阿里通义千问",value:17,color:"orange",label:"阿里通义千问"},{key:18,text:"讯飞星火认知",value:18,color:"blue",label:"讯飞星火认知"},{key:16,text:"智谱 ChatGLM",value:16,color:"violet",label:"智谱 ChatGLM"},{key:26,text:"智谱 GLM-4V",value:26,color:"purple",label:"智谱 GLM-4V"},{key:11,text:"Google PaLM2",value:11,color:"orange",label:"Google PaLM2"},{key:25,text:"Moonshot",value:25,color:"green",label:"Moonshot"},{key:19,text:"360 智脑",value:19,color:"blue",label:"360 智脑"},{key:23,text:"腾讯混元",value:23,color:"teal",label:"腾讯混元"},{key:31,text:"零一万物",value:31,color:"green",label:"零一万物"},{key:35,text:"MiniMax",value:35,color:"green",label:"MiniMax"},{key:8,text:"自定义渠道",value:8,color:"pink",label:"自定义渠道"},{key:22,text:"知识库：FastGPT",value:22,color:"blue",label:"知识库：FastGPT"},{key:21,text:"知识库：AI Proxy",value:21,color:"purple",label:"知识库：AI Proxy"}],on=({htmlContent:u})=>e.jsx("div",{dangerouslySetInnerHTML:{__html:u}});function Ie(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=10):!1}function ct(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=100):!1}function wu(){let u=localStorage.getItem("system_name");return u||"New API"}function gu(){let u=localStorage.getItem("logo");return u||"/logo.png"}function cn(){return localStorage.getItem("footer_html")}async function ze(u){let n=!0;try{await navigator.clipboard.writeText(u)}catch(i){n=!1,console.error(i)}return n}function ke(){return window.innerWidth<=600}let dt={autoClose:!1};ke()&&(dt.position="top-center");function C(u){if(console.error(u),u.message){if(u.name==="AxiosError"){switch(u.response.status){case 401:window.location.href="/login?expired=true";break;case 429:Pe.error("错误：请求次数过多，请稍后再试！");break;case 500:Pe.error("错误：服务器内部错误，请联系管理员！");break;case 405:Pe.info("本站仅作演示之用，无服务端！");break;default:Pe.error("错误："+u.message)}return}Pe.error("错误："+u.message)}else Pe.error("错误："+u)}function Je(u){Pe.warning(u)}function X(u){Pe.success(u)}function Se(u){Pe.info(u)}function Gu(u,n=!1){n?Qt(e.jsx(on,{htmlContent:u}),dt):Pe.info(u)}function fu(u){return u.endsWith("/")?u.slice(0,-1):u}function Le(u){let n=new Date(u*1e3),i=n.getFullYear().toString(),s=(n.getMonth()+1).toString(),r=n.getDate().toString(),a=n.getHours().toString(),h=n.getMinutes().toString(),y=n.getSeconds().toString();return s.length===1&&(s="0"+s),r.length===1&&(r="0"+r),a.length===1&&(a="0"+a),h.length===1&&(h="0"+h),y.length===1&&(y="0"+y),i+"-"+s+"-"+r+" "+a+":"+h+":"+y}function Js(u,n="hour"){let i=new Date(u*1e3),s=(i.getMonth()+1).toString(),r=i.getDate().toString(),a=i.getHours().toString();s.length===1&&(s="0"+s),r.length===1&&(r="0"+r),a.length===1&&(a="0"+a);let h=s+"-"+r;if(n==="hour")h+=" "+a+":00";else if(n==="week"){let y=new Date(u*1e3+5184e5),w=(y.getMonth()+1).toString(),d=y.getDate().toString();w.length===1&&(w="0"+w),d.length===1&&(d="0"+d),h+=" - "+w+"-"+d}return h}function dn(u,n){let i=new Blob([u],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(i),r=document.createElement("a");r.href=s,r.download=n,r.click()}const lu=u=>{try{JSON.parse(u)}catch{return!1}return!0};function hn(u){return!localStorage.getItem(`prompt-${u}`)}function Ye(u,n){const i=[];for(const s in u)u.hasOwnProperty(s)&&n.hasOwnProperty(s)&&u[s]!==n[s]&&i.push({key:s,oldValue:u[s],newValue:n[s]});return i}var Hu={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const P=rt.create({baseURL:Hu.VITE_REACT_APP_SERVER_URL?Hu.VITE_REACT_APP_SERVER_URL:""});P.interceptors.response.use(u=>u,u=>{C(u)});function ht(u){if(u==="")return e.jsx(z,{size:"large",children:"unknown"},"default");const n={vip:"yellow",pro:"yellow",svip:"red",premium:"red"},i=u.split(",").sort();return e.jsx("span",{children:i.map(s=>e.jsx(z,{size:"large",color:n[s]||Fu(s),children:s},s))},u)}function Au(u){return u>=1e9?(u/1e9).toFixed(1)+"B":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e4?(u/1e3).toFixed(1)+"k":u}function Ys(u,n=2){let i=localStorage.getItem("display_in_currency");return u=u.toFixed(n),i?"$"+u:u}function Fn(u){if(u=u.toFixed(2),u>=1e5){let n=u.toString(),i=n.indexOf("."),s=n,r="";return i!==-1&&(s=n.slice(0,i),r=n.slice(i)),s.slice(0,2)+".."+s.slice(-2)+r}return u}function ju(){let u=localStorage.getItem("quota_per_unit");return u=parseFloat(u),u}function pn(u){let n=localStorage.getItem("quota_per_unit");return n=parseFloat(n),u=parseFloat(u),n*u}function Zs(u,n=6){let i=localStorage.getItem("quota_per_unit");return i=parseFloat(i),(u/i).toFixed(n)}function mn(u){let n=localStorage.getItem("display_in_currency");return n=n==="true",n?"$"+u:pn(u)}function xe(u,n=2){let i=localStorage.getItem("quota_per_unit"),s=localStorage.getItem("display_in_currency");return i=parseFloat(i),s=s==="true",s?"$"+(u/i).toFixed(n):Au(u)}function gn(u,n,i,s=-1,r,a){if(s!==-1)return"模型价格：$"+s*a;{r===void 0&&(r=0);let h=i*2*a,y=i*2*r*a,w=u/1e6*h+n/1e6*y;return e.jsx(e.Fragment,{children:e.jsxs("article",{children:[e.jsxs("p",{children:["提示 $",h," / 1M tokens"]}),e.jsxs("p",{children:["补全 $",y," / 1M tokens"]}),e.jsx("p",{}),e.jsxs("p",{children:["提示 ",u," tokens / 1M tokens * $",h," + 补全"," ",n," tokens / 1M tokens * $",y," = $",w.toFixed(6)]})]})})}}function hu(u,n){let i=localStorage.getItem("display_in_currency");return i=i==="true",i?`（等价金额：${xe(u,n)}）`:""}const qu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"],Xs={"dall-e":"rgb(147,112,219)","dall-e-3":"rgb(153,50,204)","gpt-3.5-turbo":"rgb(184,227,167)","gpt-3.5-turbo-0613":"rgb(60,179,113)","gpt-3.5-turbo-1106":"rgb(32,178,170)","gpt-3.5-turbo-16k":"rgb(149,252,206)","gpt-3.5-turbo-16k-0613":"rgb(119,255,214)","gpt-3.5-turbo-instruct":"rgb(175,238,238)","gpt-4":"rgb(135,206,235)","gpt-4-0613":"rgb(100,149,237)","gpt-4-1106-preview":"rgb(30,144,255)","gpt-4-0125-preview":"rgb(2,177,236)","gpt-4-turbo-preview":"rgb(2,177,255)","gpt-4-32k":"rgb(104,111,238)","gpt-4-32k-0613":"rgb(61,71,139)","gpt-4-all":"rgb(65,105,225)","gpt-4-gizmo-*":"rgb(0,0,255)","gpt-4-vision-preview":"rgb(25,25,112)","text-ada-001":"rgb(255,192,203)","text-babbage-001":"rgb(255,160,122)","text-curie-001":"rgb(219,112,147)","text-davinci-003":"rgb(219,112,147)","text-davinci-edit-001":"rgb(255,105,180)","text-embedding-ada-002":"rgb(255,182,193)","text-embedding-v1":"rgb(255,174,185)","text-moderation-latest":"rgb(255,130,171)","text-moderation-stable":"rgb(255,160,122)","tts-1":"rgb(255,140,0)","tts-1-1106":"rgb(255,165,0)","tts-1-hd":"rgb(255,215,0)","tts-1-hd-1106":"rgb(255,223,0)","whisper-1":"rgb(245,245,220)","claude-3-opus-20240229":"rgb(255,132,31)","claude-3-sonnet-20240229":"rgb(253,135,93)","claude-3-haiku-20240307":"rgb(255,175,146)","claude-2.1":"rgb(255,209,190)"};function Fu(u){let n=0;for(let s=0;s<u.length;s++)n+=u.charCodeAt(s);let i=n%qu.length;return qu[i]}const xn=u=>{const n={username:"",display_name:"",password:""},[i,s]=t.useState(n),[r,a]=t.useState(!1),{username:h,display_name:y,password:w}=i,d=(x,_)=>{s(M=>({...M,[x]:_}))},l=async()=>{if(a(!0),i.username===""||i.password==="")return;const x=await P.post("/api/user/",i),{success:_,message:M}=x.data;_?(X("用户账户创建成功！"),s(n),u.refresh(),u.handleClose()):C(M),a(!1)},F=()=>{u.handleClose()};return e.jsx(e.Fragment,{children:e.jsx(mu,{placement:"left",title:e.jsx(tu,{level:3,children:"添加用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:l,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:F,children:"取消"})]})}),closeIcon:null,onCancel:()=>F(),width:ke()?"100%":600,children:e.jsxs(Ae,{spinning:r,children:[e.jsx(le,{style:{marginTop:20},label:"用户名",name:"username",addonBefore:"用户名",placeholder:"请输入用户名",onChange:x=>d("username",x),value:h,autoComplete:"off"}),e.jsx(le,{style:{marginTop:20},addonBefore:"显示名",label:"显示名称",name:"display_name",autoComplete:"off",placeholder:"请输入显示名称",onChange:x=>d("display_name",x),value:y}),e.jsx(le,{style:{marginTop:20},label:"密 码",name:"password",type:"password",addonBefore:"密码",placeholder:"请输入密码",onChange:x=>d("password",x),value:w,autoComplete:"off"})]})})})},$u=u=>{const n=u.editingUser.id,[i,s]=t.useState(!0),[r,a]=t.useState(!1),[h,y]=t.useState(""),[w,d]=t.useState({username:"",display_name:"",password:"",github_id:"",wechat_id:"",email:"",quota:0,group:"default"}),[l,F]=t.useState([]),{username:x,display_name:_,password:M,github_id:I,wechat_id:$,telegram_id:S,email:q,quota:H,group:te}=w,Y=(g,R)=>{d(E=>({...E,[g]:R}))},Z=async()=>{try{let g=await P.get("/api/group/");F(g.data.data.map(R=>({label:R,value:R})))}catch(g){C(g.message)}};Re();const L=()=>{u.handleClose()},ne=async()=>{s(!0);let g;n?g=await P.get(`/api/user/${n}`):g=await P.get("/api/user/self");const{success:R,message:E,data:B}=g.data;R?(B.password="",d(B)):C(E),s(!1)};t.useEffect(()=>{ne().then(),n&&Z().then()},[u.editingUser.id]);const re=async()=>{s(!0);let g;if(n){let B={...w,id:parseInt(n)};typeof B.quota=="string"&&(B.quota=parseInt(B.quota)),g=await P.put("/api/user/",B)}else g=await P.put("/api/user/self",w);const{success:R,message:E}=g.data;R?(X("用户信息更新成功！"),u.refresh(),u.handleClose()):C(E),s(!1)},b=()=>{let g=parseInt(H)+parseInt(h);d(R=>({...R,quota:g}))},p=()=>{y("0"),a(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(mu,{placement:"right",title:e.jsx(tu,{level:3,children:"编辑用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:re,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:L,children:"取消"})]})}),closeIcon:null,onCancel:()=>L(),width:ke()?"100%":600,children:e.jsxs(Ae,{spinning:i,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"用户名"})}),e.jsx(le,{label:"用户名",name:"username",placeholder:"请输入新的用户名",onChange:g=>Y("username",g),value:x,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"密码"})}),e.jsx(le,{label:"密码",name:"password",type:"password",placeholder:"请输入新的密码，最短 8 位",onChange:g=>Y("password",g),value:M,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"显示名称"})}),e.jsx(le,{label:"显示名称",name:"display_name",placeholder:"请输入新的显示名称",onChange:g=>Y("display_name",g),value:_,autoComplete:"new-password"}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"分组"})}),e.jsx(Me,{placeholder:"请选择分组",name:"group",fluid:!0,search:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:g=>Y("group",g),value:w.group,autoComplete:"new-password",optionList:l}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:`剩余额度${hu(H)}`})}),e.jsxs(de,{children:[e.jsx(le,{name:"quota",placeholder:"请输入新的剩余额度",onChange:g=>Y("quota",g),value:H,type:"number",autoComplete:"new-password"}),e.jsx(T,{onClick:p,children:"添加额度"})]})]}),e.jsx(Du,{style:{marginTop:20},children:"以下信息不可修改"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"已绑定的 GitHub 账户"})}),e.jsx(le,{name:"github_id",value:I,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"已绑定的微信账户"})}),e.jsx(le,{name:"wechat_id",value:$,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"已绑定的邮箱账户"})}),e.jsx(le,{name:"email",value:q,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"已绑定的Telegram账户"})}),e.jsx(le,{name:"telegram_id",value:S,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0})]})}),e.jsxs(ye,{centered:!0,visible:r,onOk:()=>{b(),a(!1)},onCancel:()=>a(!1),closable:null,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:`新额度${xe(H)} + ${xe(h)} = ${xe(H+parseInt(h))}`})}),e.jsx(le,{name:"addQuotaLocal",placeholder:"需要添加的额度（支持负数）",onChange:g=>{y(g)},value:h,type:"number",autoComplete:"new-password"})]})]})};function En(u){switch(u){case 1:return e.jsx(z,{size:"large",children:"普通用户"});case 10:return e.jsx(z,{color:"yellow",size:"large",children:"管理员"});case 100:return e.jsx(z,{color:"orange",size:"large",children:"超级管理员"});default:return e.jsx(z,{color:"red",size:"large",children:"未知身份"})}}const Cn=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"用户名",dataIndex:"username"},{title:"分组",dataIndex:"group",render:(o,m,D)=>e.jsx("div",{children:ht(o)})},{title:"统计信息",dataIndex:"info",render:(o,m,D)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx($e,{content:"剩余额度",children:e.jsx(z,{color:"white",size:"large",children:xe(m.quota)})}),e.jsx($e,{content:"已用额度",children:e.jsx(z,{color:"white",size:"large",children:xe(m.used_quota)})}),e.jsx($e,{content:"调用次数",children:e.jsx(z,{color:"white",size:"large",children:Au(m.request_count)})})]})})},{title:"邀请信息",dataIndex:"invite",render:(o,m,D)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx($e,{content:"邀请人数",children:e.jsx(z,{color:"white",size:"large",children:Au(m.aff_count)})}),e.jsx($e,{content:"邀请总收益",children:e.jsx(z,{color:"white",size:"large",children:xe(m.aff_history_quota)})}),e.jsx($e,{content:"邀请人ID",children:m.inviter_id===0?e.jsx(z,{color:"white",size:"large",children:"无"}):e.jsx(z,{color:"white",size:"large",children:m.inviter_id})})]})})},{title:"角色",dataIndex:"role",render:(o,m,D)=>e.jsx("div",{children:En(o)})},{title:"状态",dataIndex:"status",render:(o,m,D)=>e.jsx("div",{children:m.DeletedAt!==null?e.jsx(z,{color:"red",children:"已注销"}):p(o)})},{title:"",dataIndex:"operate",render:(o,m,D)=>e.jsxs("div",{children:[m.DeletedAt!==null?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:()=>{b(m.username,"promote",m)},children:e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},children:"提升"})}),e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:()=>{b(m.username,"demote",m)},children:e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},children:"降级"})}),m.status===1?e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{b(m.username,"disable",m)},children:"禁用"}):e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{b(m.username,"enable",m)},disabled:m.status===3,children:"启用"}),e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{Z(m),te(!0)},children:"编辑"})]}),e.jsx(ve,{title:"确定是否要删除此用户？",content:"硬删除，此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{b(m.username,"delete",m).then(()=>{ne(m.id)})},children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})})]})}],[n,i]=t.useState([]),[s,r]=t.useState(!0),[a,h]=t.useState(1),[y,w]=t.useState(""),[d,l]=t.useState(!1),[F,x]=t.useState(""),[_,M]=t.useState([]),[I,$]=t.useState(Fe),[S,q]=t.useState(!1),[H,te]=t.useState(!1),[Y,Z]=t.useState({id:void 0}),L=o=>{o.length>=a*Fe?$(o.length+1):$(o.length)},ne=o=>{console.log(o);let m=[...n];if(o!=null){let D=m.findIndex(W=>W.id===o);D>-1&&(m.splice(D,1),i(m))}},re=async o=>{const m=await P.get(`/api/user/?p=${o}`),{success:D,message:W,data:ee}=m.data;if(D)if(o===0)i(ee),L(ee);else{let j=n;j.push(...ee),i(j),L(j)}else C(W);r(!1)};t.useEffect(()=>{re(0).then().catch(o=>{C(o)}),U().then()},[]);const b=async(o,m,D)=>{const W=await P.post("/api/user/manage",{username:o,action:m}),{success:ee,message:j}=W.data;if(ee){X("操作成功完成！");let K=W.data.data,ae=[...n];m==="delete"||(D.status=K.status,D.role=K.role),i(ae)}else C(j)},p=o=>{switch(o){case 1:return e.jsx(z,{size:"large",children:"已激活"});case 2:return e.jsx(z,{size:"large",color:"red",children:"已封禁"});default:return e.jsx(z,{size:"large",color:"grey",children:"未知状态"})}},g=async(o,m)=>{if(o===""&&m===""){await re(0),h(1);return}l(!0);const D=await P.get(`/api/user/search?keyword=${o}&group=${m}`),{success:W,message:ee,data:j}=D.data;W?(i(j),h(1)):C(ee),l(!1)},R=async o=>{w(o.trim())},E=o=>{h(o),o===Math.ceil(n.length/Fe)+1&&re(o-1).then(m=>{})},B=n.slice((a-1)*Fe,a*Fe),c=()=>{q(!1)},f=()=>{te(!1),Z({id:void 0})},v=async()=>{y===""?await re(a-1):await g()},U=async()=>{try{let o=await P.get("/api/group/");if(o===void 0)return;M(o.data.data.map(m=>({label:m,value:m})))}catch(o){C(o.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(xn,{refresh:v,visible:S,handleClose:c}),e.jsx($u,{refresh:v,visible:H,handleClose:f,editingUser:Y}),e.jsx(N,{onSubmit:()=>{g(y,F)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(de,{children:[e.jsx(N.Input,{label:"搜索关键字",icon:"search",field:"keyword",iconPosition:"left",placeholder:"搜索用户的 ID，用户名，显示名称，以及邮箱地址 ...",value:y,loading:d,onChange:o=>R(o)}),e.jsx(N.Select,{field:"group",label:"分组",optionList:_,onChange:o=>{x(o),g(y,o)}}),e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx(nu,{columns:u,dataSource:B,pagination:{currentPage:a,pageSize:Fe,total:I,pageSizeOpts:[10,20,50,100],onPageChange:E},loading:s}),e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{q(!0)},children:"添加用户"})]})},fn=()=>e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(ce.Header,{children:e.jsx("h3",{children:"管理用户"})}),e.jsx(ce.Content,{children:e.jsx(Cn,{})})]})});function We({children:u}){return localStorage.getItem("user")?u:e.jsx(Dt,{to:"/login",state:{from:ln.location}})}const jn=()=>{const[u,n]=t.useState({username:"",password:"",password2:"",email:"",verification_code:""}),{username:i,password:s,password2:r}=u,[a,h]=t.useState(!1),[y,w]=t.useState(!1),[d,l]=t.useState(""),[F,x]=t.useState(""),[_,M]=t.useState(!1),I=gu();let $=new URLSearchParams(window.location.search).get("aff");$&&localStorage.setItem("aff",$),t.useEffect(()=>{let Y=localStorage.getItem("status");Y&&(Y=JSON.parse(Y),h(Y.email_verification),Y.turnstile_check&&(w(!0),l(Y.turnstile_site_key)))});let S=Re();function q(Y){const{name:Z,value:L}=Y.target;console.log(Z,L),n(ne=>({...ne,[Z]:L}))}async function H(Y){if(s.length<8){Se("密码长度不得小于 8 位！");return}if(s!==r){Se("两次输入的密码不一致");return}if(i&&s){if(y&&F===""){Se("请稍后几秒重试，Turnstile 正在检查用户环境！");return}M(!0),$||($=localStorage.getItem("aff")),u.aff_code=$;const Z=await P.post(`/api/user/register?turnstile=${F}`,u),{success:L,message:ne}=Z.data;L?(S("/login"),X("注册成功！")):C(ne),M(!1)}}const te=async()=>{if(u.email==="")return;if(y&&F===""){Se("请稍后几秒重试，Turnstile 正在检查用户环境！");return}M(!0);const Y=await P.get(`/api/verification?email=${u.email}&turnstile=${F}`),{success:Z,message:L}=Y.data;Z?X("验证码发送成功，请检查你的邮箱！"):C(L),M(!1)};return e.jsx(Qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(Qe.Column,{style:{maxWidth:450},children:[e.jsxs(De,{as:"h2",color:"",textAlign:"center",children:[e.jsx(Lu,{src:I})," 新用户注册"]}),e.jsx(G,{size:"large",children:e.jsxs(bu,{children:[e.jsx(G.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"输入用户名，最长 12 位",onChange:q,name:"username"}),e.jsx(G.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:q,name:"password",type:"password"}),e.jsx(G.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:q,name:"password2",type:"password"}),a?e.jsxs(e.Fragment,{children:[e.jsx(G.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"输入邮箱地址",onChange:q,name:"email",type:"email",action:e.jsx(uu,{onClick:te,disabled:_,children:"获取验证码"})}),e.jsx(G.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入验证码",onChange:q,name:"verification_code"})]}):e.jsx(e.Fragment,{}),y?e.jsx(ou,{sitekey:d,onVerify:Y=>{x(Y)}}):e.jsx(e.Fragment,{}),e.jsx(uu,{color:"green",fluid:!0,size:"large",onClick:H,loading:_,children:"注册"})]})}),e.jsxs(Bu,{children:["已有账户？",e.jsx(cu,{to:"/login",className:"btn btn-link",children:"点击登录"})]})]})})},yn=(u,n)=>{switch(n.type){case"login":return{...u,user:n.payload};case"logout":return{...u,user:void 0};default:return u}},Ft={user:void 0},Ze=pu.createContext({state:Ft,dispatch:()=>null}),Dn=({children:u})=>{const[n,i]=pu.useReducer(yn,Ft);return e.jsx(Ze.Provider,{value:[n,i],children:u})};async function Bn(){const u=await P.get("/api/oauth/state"),{success:n,message:i,data:s}=u.data;return n?s:(C(i),"")}async function pt(u){const n=await Bn();n&&window.open(`https://github.com/login/oauth/authorize?client_id=${u}&state=${n}&scope=user:email`)}let qe;async function An(){const u=await P.get("/api/models"),{success:n,data:i}=u.data;n&&(qe=i,localStorage.setItem("channel_models",JSON.stringify(i)))}function ku(u){if(qe!==void 0&&u in qe)return qe[u]?qe[u]:[];let n=localStorage.getItem("channel_models");return n?(qe=JSON.parse(n),u in qe?qe[u]:[]):[]}const bn=()=>{function u(){return e.jsxs("svg",{t:"1709714447384",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5091",width:"16",height:"16",children:[e.jsx("path",{d:"M690.1 377.4c5.9 0 11.8 0.2 17.6 0.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6 5.5 3.9 9.1 10.3 9.1 17.6 0 2.4-0.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-0.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-0.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4 0.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-0.1 17.8-0.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8z m-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1z m-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1z","p-id":"5092"}),e.jsx("path",{d:"M866.7 792.7c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-0.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7 2.4 0 4.7-0.9 6.4-2.6 1.7-1.7 2.6-4 2.6-6.4 0-2.2-0.9-4.4-1.4-6.6-0.3-1.2-7.6-28.3-12.2-45.3-0.5-1.9-0.9-3.8-0.9-5.7 0.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9z m179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c-0.1 19.8-16.2 35.9-36 35.9z","p-id":"5093"})]})}return e.jsx("div",{children:e.jsx(Xu,{svg:e.jsx(u,{})})})};function Sn(u){localStorage.setItem("status",JSON.stringify(u)),localStorage.setItem("system_name",u.system_name),localStorage.setItem("logo",u.logo),localStorage.setItem("footer_html",u.footer_html),localStorage.setItem("quota_per_unit",u.quota_per_unit),localStorage.setItem("display_in_currency",u.display_in_currency),localStorage.setItem("enable_drawing",u.enable_drawing),localStorage.setItem("enable_data_export",u.enable_data_export),localStorage.setItem("data_export_default_time",u.data_export_default_time),localStorage.setItem("default_collapse_sidebar",u.default_collapse_sidebar),localStorage.setItem("mj_notify_enabled",u.mj_notify_enabled),u.chat_link?localStorage.setItem("chat_link",u.chat_link):localStorage.removeItem("chat_link"),u.chat_link2?localStorage.setItem("chat_link2",u.chat_link2):localStorage.removeItem("chat_link2")}function wn(u){localStorage.setItem("user",JSON.stringify(u))}const _n=()=>{const[u,n]=t.useState({username:"",password:"",wechat_verification_code:""}),[i,s]=Ou(),[r,a]=t.useState(!1),{username:h,password:y}=u,[w,d]=t.useContext(Ze),[l,F]=t.useState(!1),[x,_]=t.useState(""),[M,I]=t.useState("");let $=Re();const[S,q]=t.useState({});gu(),t.useEffect(()=>{i.get("expired")&&C("未登录或登录已过期，请重新登录！");let b=localStorage.getItem("status");b&&(b=JSON.parse(b),q(b),b.turnstile_check&&(F(!0),_(b.turnstile_site_key)))},[]);const[H,te]=t.useState(!1),Y=()=>{te(!0)},Z=async()=>{if(l&&M===""){Se("请稍后几秒重试，Turnstile 正在检查用户环境！");return}const b=await P.get(`/api/oauth/wechat?code=${u.wechat_verification_code}`),{success:p,message:g,data:R}=b.data;p?(d({type:"login",payload:R}),localStorage.setItem("user",JSON.stringify(R)),$("/"),X("登录成功！"),te(!1)):C(g)};function L(b,p){n(g=>({...g,[b]:p}))}async function ne(b){if(l&&M===""){Se("请稍后几秒重试，Turnstile 正在检查用户环境！");return}if(a(!0),h&&y){const p=await P.post(`/api/user/login?turnstile=${M}`,{username:h,password:y}),{success:g,message:R,data:E}=p.data;g?(d({type:"login",payload:E}),wn(E),X("登录成功！"),h==="root"&&y==="123456"&&ye.error({title:"您正在使用默认密码！",content:"请立刻修改默认密码！",centered:!0}),$("/token")):C(R)}else C("请输入用户名和密码！")}const re=async b=>{const p=["id","first_name","last_name","username","photo_url","auth_date","hash","lang"],g={};p.forEach(f=>{b[f]&&(g[f]=b[f])});const R=await P.get("/api/oauth/telegram/login",{params:g}),{success:E,message:B,data:c}=R.data;E?(d({type:"login",payload:c}),localStorage.setItem("user",JSON.stringify(c)),X("登录成功！"),$("/")):C(B)};return e.jsx("div",{children:e.jsxs(ce,{children:[e.jsx(ce.Header,{}),e.jsx(ce.Content,{children:e.jsx("div",{style:{justifyContent:"center",display:"flex",marginTop:120},children:e.jsxs("div",{style:{width:500},children:[e.jsxs(we,{children:[e.jsx(tu,{heading:2,style:{textAlign:"center"},children:"用户登录"}),e.jsxs(N,{children:[e.jsx(N.Input,{field:"username",label:"用户名",placeholder:"用户名",name:"username",onChange:b=>L("username",b)}),e.jsx(N.Input,{field:"password",label:"密码",placeholder:"密码",name:"password",type:"password",onChange:b=>L("password",b)}),e.jsx(T,{theme:"solid",style:{width:"100%"},type:"primary",size:"large",htmlType:"submit",onClick:ne,children:"登录"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:20},children:[e.jsxs(iu,{children:["没有账号请先 ",e.jsx(cu,{to:"/register",children:"注册账号"})]}),e.jsxs(iu,{children:["忘记密码 ",e.jsx(cu,{to:"/reset",children:"点击重置"})]})]}),S.github_oauth||S.wechat_login||S.telegram_oauth?e.jsxs(e.Fragment,{children:[e.jsx(Du,{margin:"12px",align:"center",children:"第三方登录"}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:[S.github_oauth?e.jsx(T,{type:"primary",icon:e.jsx(vt,{}),onClick:()=>pt(S.github_client_id)}):e.jsx(e.Fragment,{}),S.wechat_login?e.jsx(T,{type:"primary",style:{color:"rgba(var(--semi-green-5), 1)"},icon:e.jsx(Xu,{svg:e.jsx(bn,{})}),onClick:Y}):e.jsx(e.Fragment,{})]}),S.telegram_oauth?e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:5},children:e.jsx(it,{dataOnauth:re,botName:S.telegram_bot_name})})}):e.jsx(e.Fragment,{})]}):e.jsx(e.Fragment,{}),e.jsxs(ye,{title:"微信扫码登录",visible:H,maskClosable:!0,onOk:Z,onCancel:()=>te(!1),okText:"登录",size:"small",centered:!0,children:[e.jsx("div",{style:{display:"flex",alignItem:"center",flexDirection:"column"},children:e.jsx("img",{src:S.wechat_qrcode})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(N,{size:"large",children:e.jsx(N.Input,{field:"wechat_verification_code",placeholder:"验证码",label:"验证码",value:u.wechat_verification_code,onChange:b=>L("wechat_verification_code",b)})})]})]}),l?e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:e.jsx(ou,{sitekey:x,onVerify:b=>{I(b)}})}):e.jsx(e.Fragment,{})]})})})]})})},vn=()=>e.jsx(e.Fragment,{children:e.jsxs(Bu,{negative:!0,children:[e.jsx(Bu.Header,{children:"页面不存在"}),e.jsx("p",{children:"请检查你的浏览器地址是否正确"})]})}),mt=t.createContext(null),gt=()=>t.useContext(mt),xt=t.createContext(null),kn=()=>t.useContext(xt),Tn=({children:u})=>{const[n,i]=t.useState(()=>{try{return localStorage.getItem("theme-mode")||null}catch{return null}}),s=t.useCallback(r=>{i(r?"dark":"light");const a=document.body;r?(a.setAttribute("theme-mode","dark"),localStorage.setItem("theme-mode","dark")):(a.removeAttribute("theme-mode"),localStorage.setItem("theme-mode","light"))},[]);return e.jsx(xt.Provider,{value:s,children:e.jsx(mt.Provider,{value:n,children:u})})},In=()=>{let[u,n]=t.useState({PasswordLoginEnabled:"",PasswordRegisterEnabled:"",EmailVerificationEnabled:"",GitHubOAuthEnabled:"",GitHubClientId:"",GitHubClientSecret:"",Notice:"",SMTPServer:"",SMTPPort:"",SMTPAccount:"",SMTPFrom:"",SMTPToken:"",ServerAddress:"",WorkerUrl:"",WorkerValidKey:"",EpayId:"",EpayKey:"",Price:7.3,MinTopUp:1,TopupGroupRatio:"",PayAddress:"",CustomCallbackAddress:"",Footer:"",WeChatAuthEnabled:"",WeChatServerAddress:"",WeChatServerToken:"",WeChatAccountQRCodeImageURL:"",TurnstileCheckEnabled:"",TurnstileSiteKey:"",TurnstileSecretKey:"",RegisterEnabled:"",EmailDomainRestrictionEnabled:"",EmailAliasRestrictionEnabled:"",SMTPSSLEnabled:"",EmailDomainWhitelist:[],TelegramOAuthEnabled:"",TelegramBotToken:"",TelegramBotName:""});const[i,s]=t.useState({});let[r,a]=t.useState(!1);const[h,y]=t.useState([]),[w,d]=t.useState(""),[l,F]=t.useState(!1),_=gt()==="dark",M=async()=>{const p=await P.get("/api/option/"),{success:g,message:R,data:E}=p.data;if(g){let B={};E.forEach(c=>{c.key==="TopupGroupRatio"&&(c.value=JSON.stringify(JSON.parse(c.value),null,2)),B[c.key]=c.value}),n({...B,EmailDomainWhitelist:B.EmailDomainWhitelist.split(",")}),s(B),y(B.EmailDomainWhitelist.split(",").map(c=>({key:c,text:c,value:c})))}else C(R)};t.useEffect(()=>{M().then()},[]),t.useEffect(()=>{},[u.EmailDomainWhitelist]);const I=async(p,g)=>{switch(a(!0),p){case"PasswordLoginEnabled":case"PasswordRegisterEnabled":case"EmailVerificationEnabled":case"GitHubOAuthEnabled":case"WeChatAuthEnabled":case"TelegramOAuthEnabled":case"TurnstileCheckEnabled":case"EmailDomainRestrictionEnabled":case"EmailAliasRestrictionEnabled":case"SMTPSSLEnabled":case"RegisterEnabled":g=u[p]==="true"?"false":"true";break}const R=await P.put("/api/option/",{key:p,value:g}),{success:E,message:B}=R.data;E?(p==="EmailDomainWhitelist"&&(g=g.split(",")),p==="Price"&&(g=parseFloat(g)),n(c=>({...c,[p]:g}))):C(B),a(!1)},$=async(p,{name:g,value:R})=>{if(g==="PasswordLoginEnabled"&&u[g]==="true"){F(!0);return}g==="Notice"||g.startsWith("SMTP")&&g!=="SMTPSSLEnabled"||g==="ServerAddress"||g==="WorkerUrl"||g==="WorkerValidKey"||g==="EpayId"||g==="EpayKey"||g==="Price"||g==="PayAddress"||g==="GitHubClientId"||g==="GitHubClientSecret"||g==="WeChatServerAddress"||g==="WeChatServerToken"||g==="WeChatAccountQRCodeImageURL"||g==="TurnstileSiteKey"||g==="TurnstileSecretKey"||g==="EmailDomainWhitelist"||g==="TopupGroupRatio"||g==="TelegramBotToken"||g==="TelegramBotName"?n(E=>({...E,[g]:R})):await I(g,R)},S=async()=>{let p=fu(u.ServerAddress);await I("ServerAddress",p)},q=async()=>{let p=fu(u.WorkerUrl);await I("WorkerUrl",p),u.WorkerValidKey!==""&&await I("WorkerValidKey",u.WorkerValidKey)},H=async()=>{if(u.ServerAddress===""){C("请先填写服务器地址");return}if(i.TopupGroupRatio!==u.TopupGroupRatio){if(!lu(u.TopupGroupRatio)){C("充值分组倍率不是合法的 JSON 字符串");return}await I("TopupGroupRatio",u.TopupGroupRatio)}let p=fu(u.PayAddress);await I("PayAddress",p),u.EpayId!==""&&await I("EpayId",u.EpayId),u.EpayKey!==void 0&&u.EpayKey!==""&&await I("EpayKey",u.EpayKey),await I("Price",""+u.Price)},te=async()=>{i.SMTPServer!==u.SMTPServer&&await I("SMTPServer",u.SMTPServer),i.SMTPAccount!==u.SMTPAccount&&await I("SMTPAccount",u.SMTPAccount),i.SMTPFrom!==u.SMTPFrom&&await I("SMTPFrom",u.SMTPFrom),i.SMTPPort!==u.SMTPPort&&u.SMTPPort!==""&&await I("SMTPPort",u.SMTPPort),i.SMTPToken!==u.SMTPToken&&u.SMTPToken!==""&&await I("SMTPToken",u.SMTPToken)},Y=async()=>{i.EmailDomainWhitelist!==u.EmailDomainWhitelist.join(",")&&u.SMTPToken!==""&&await I("EmailDomainWhitelist",u.EmailDomainWhitelist.join(","))},Z=async()=>{i.WeChatServerAddress!==u.WeChatServerAddress&&await I("WeChatServerAddress",fu(u.WeChatServerAddress)),i.WeChatAccountQRCodeImageURL!==u.WeChatAccountQRCodeImageURL&&await I("WeChatAccountQRCodeImageURL",u.WeChatAccountQRCodeImageURL),i.WeChatServerToken!==u.WeChatServerToken&&u.WeChatServerToken!==""&&await I("WeChatServerToken",u.WeChatServerToken)},L=async()=>{i.GitHubClientId!==u.GitHubClientId&&await I("GitHubClientId",u.GitHubClientId),i.GitHubClientSecret!==u.GitHubClientSecret&&u.GitHubClientSecret!==""&&await I("GitHubClientSecret",u.GitHubClientSecret)},ne=async()=>{await I("TelegramBotToken",u.TelegramBotToken),await I("TelegramBotName",u.TelegramBotName)},re=async()=>{i.TurnstileSiteKey!==u.TurnstileSiteKey&&await I("TurnstileSiteKey",u.TurnstileSiteKey),i.TurnstileSecretKey!==u.TurnstileSecretKey&&u.TurnstileSecretKey!==""&&await I("TurnstileSecretKey",u.TurnstileSecretKey)},b=()=>{const p=u.EmailDomainWhitelist;w!==""&&!p.includes(w)&&(d(""),n({...u,EmailDomainWhitelist:[...p,w]}),y([...h,{key:w,text:w,value:w}]))};return e.jsx(Qe,{columns:1,children:e.jsx(Qe.Column,{children:e.jsxs(G,{loading:r,inverted:_,children:[e.jsx(De,{as:"h3",inverted:_,children:"通用设置"}),e.jsx(G.Group,{widths:"equal",children:e.jsx(G.Input,{label:"服务器地址",placeholder:"例如：https://yourdomain.com",value:u.ServerAddress,name:"ServerAddress",onChange:$})}),e.jsx(G.Button,{onClick:S,children:"更新服务器地址"}),e.jsxs(De,{as:"h3",inverted:_,children:["代理设置（支持 ",e.jsx("a",{href:"https://github.com/Calcium-Ion/new-api-worker",target:"_blank",rel:"noreferrer",children:"new-api-worker"}),"）"]}),e.jsxs(G.Group,{widths:"equal",children:[e.jsx(G.Input,{label:"Worker地址，不填写则不启用代理",placeholder:"例如：https://workername.yourdomain.workers.dev",value:u.WorkerUrl,name:"WorkerUrl",onChange:$}),e.jsx(G.Input,{label:"Worker密钥，根据你部署的 Worker 填写",placeholder:"例如：your_secret_key",value:u.WorkerValidKey,name:"WorkerValidKey",onChange:$})]}),e.jsx(G.Button,{onClick:q,children:"更新Worker设置"}),e.jsx(_e,{}),e.jsx(De,{as:"h3",inverted:_,children:"支付设置（当前仅支持易支付接口，默认使用上方服务器地址作为回调地址！）"}),e.jsxs(G.Group,{widths:"equal",children:[e.jsx(G.Input,{label:"支付地址，不填写则不启用在线支付",placeholder:"例如：https://yourdomain.com",value:u.PayAddress,name:"PayAddress",onChange:$}),e.jsx(G.Input,{label:"易支付商户ID",placeholder:"例如：0001",value:u.EpayId,name:"EpayId",onChange:$}),e.jsx(G.Input,{label:"易支付商户密钥",placeholder:"敏感信息不会发送到前端显示",value:u.EpayKey,name:"EpayKey",onChange:$})]}),e.jsxs(G.Group,{widths:"equal",children:[e.jsx(G.Input,{label:"回调地址，不填写则使用上方服务器地址作为回调地址",placeholder:"例如：https://yourdomain.com",value:u.CustomCallbackAddress,name:"CustomCallbackAddress",onChange:$}),e.jsx(G.Input,{label:"充值价格（x元/美金）",placeholder:"例如：7，就是7元/美金",value:u.Price,name:"Price",min:0,onChange:$}),e.jsx(G.Input,{label:"最低充值美元数量（以美金为单位，如果使用额度请自行换算！）",placeholder:"例如：2，就是最低充值2$",value:u.MinTopUp,name:"MinTopUp",min:1,onChange:$})]}),e.jsx(G.Group,{widths:"equal",children:e.jsx(G.TextArea,{label:"充值分组倍率",name:"TopupGroupRatio",onChange:$,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:u.TopupGroupRatio,placeholder:"为一个 JSON 文本，键为组名称，值为倍率"})}),e.jsx(G.Button,{onClick:H,children:"更新支付设置"}),e.jsx(_e,{}),e.jsx(De,{as:"h3",inverted:_,children:"配置登录注册"}),e.jsxs(G.Group,{inline:!0,children:[e.jsx(G.Checkbox,{checked:u.PasswordLoginEnabled==="true",label:"允许通过密码进行登录",name:"PasswordLoginEnabled",onChange:$}),l&&e.jsxs(Cu,{open:l,onClose:()=>F(!1),size:"tiny",style:{maxWidth:"450px"},children:[e.jsx(Cu.Header,{children:"警告"}),e.jsx(Cu.Content,{children:e.jsx("p",{children:"取消密码登录将导致所有未绑定其他登录方式的用户（包括管理员）无法通过密码登录，确认取消？"})}),e.jsxs(Cu.Actions,{children:[e.jsx(uu,{onClick:()=>F(!1),children:"取消"}),e.jsx(uu,{color:"yellow",onClick:async()=>{F(!1),await I("PasswordLoginEnabled","false")},children:"确定"})]})]}),e.jsx(G.Checkbox,{checked:u.PasswordRegisterEnabled==="true",label:"允许通过密码进行注册",name:"PasswordRegisterEnabled",onChange:$}),e.jsx(G.Checkbox,{checked:u.EmailVerificationEnabled==="true",label:"通过密码注册时需要进行邮箱验证",name:"EmailVerificationEnabled",onChange:$}),e.jsx(G.Checkbox,{checked:u.GitHubOAuthEnabled==="true",label:"允许通过 GitHub 账户登录 & 注册",name:"GitHubOAuthEnabled",onChange:$}),e.jsx(G.Checkbox,{checked:u.WeChatAuthEnabled==="true",label:"允许通过微信登录 & 注册",name:"WeChatAuthEnabled",onChange:$}),e.jsx(G.Checkbox,{checked:u.TelegramOAuthEnabled==="true",label:"允许通过 Telegram 进行登录",name:"TelegramOAuthEnabled",onChange:$})]}),e.jsxs(G.Group,{inline:!0,children:[e.jsx(G.Checkbox,{checked:u.RegisterEnabled==="true",label:"允许新用户注册（此项为否时，新用户将无法以任何方式进行注册）",name:"RegisterEnabled",onChange:$}),e.jsx(G.Checkbox,{checked:u.TurnstileCheckEnabled==="true",label:"启用 Turnstile 用户校验",name:"TurnstileCheckEnabled",onChange:$})]}),e.jsx(_e,{}),e.jsxs(De,{as:"h3",inverted:_,children:["配置邮箱域名白名单",e.jsx(De.Subheader,{children:"用以防止恶意用户利用临时邮箱批量注册"})]}),e.jsx(G.Group,{widths:3,children:e.jsx(G.Checkbox,{label:"启用邮箱域名白名单",name:"EmailDomainRestrictionEnabled",onChange:$,checked:u.EmailDomainRestrictionEnabled==="true"})}),e.jsx(G.Group,{widths:3,children:e.jsx(G.Checkbox,{label:"启用邮箱别名限制（例如：ab.cd@gmail.com）",name:"EmailAliasRestrictionEnabled",onChange:$,checked:u.EmailAliasRestrictionEnabled==="true"})}),e.jsxs(G.Group,{widths:2,children:[e.jsx(G.Dropdown,{label:"允许的邮箱域名",placeholder:"允许的邮箱域名",name:"EmailDomainWhitelist",required:!0,fluid:!0,multiple:!0,selection:!0,onChange:$,value:u.EmailDomainWhitelist,autoComplete:"new-password",options:h}),e.jsx(G.Input,{label:"添加新的允许的邮箱域名",action:e.jsx(uu,{type:"button",onClick:()=>{b()},children:"填入"}),onKeyDown:p=>{p.key==="Enter"&&b()},autoComplete:"new-password",placeholder:"输入新的允许的邮箱域名",value:w,onChange:(p,{value:g})=>{d(g)}})]}),e.jsx(G.Button,{onClick:Y,children:"保存邮箱域名白名单设置"}),e.jsx(_e,{}),e.jsxs(De,{as:"h3",inverted:_,children:["配置 SMTP",e.jsx(De.Subheader,{children:"用以支持系统的邮件发送"})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"SMTP 服务器地址",name:"SMTPServer",onChange:$,autoComplete:"new-password",value:u.SMTPServer,placeholder:"例如：smtp.qq.com"}),e.jsx(G.Input,{label:"SMTP 端口",name:"SMTPPort",onChange:$,autoComplete:"new-password",value:u.SMTPPort,placeholder:"默认: 587"}),e.jsx(G.Input,{label:"SMTP 账户",name:"SMTPAccount",onChange:$,autoComplete:"new-password",value:u.SMTPAccount,placeholder:"通常是邮箱地址"})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"SMTP 发送者邮箱",name:"SMTPFrom",onChange:$,autoComplete:"new-password",value:u.SMTPFrom,placeholder:"通常和邮箱地址保持一致"}),e.jsx(G.Input,{label:"SMTP 访问凭证",name:"SMTPToken",onChange:$,type:"password",autoComplete:"new-password",checked:u.RegisterEnabled==="true",placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(G.Group,{widths:3,children:e.jsx(G.Checkbox,{label:"启用SMTP SSL（465端口强制开启）",name:"SMTPSSLEnabled",onChange:$,checked:u.SMTPSSLEnabled==="true"})}),e.jsx(G.Button,{onClick:te,children:"保存 SMTP 设置"}),e.jsx(_e,{}),e.jsxs(De,{as:"h3",inverted:_,children:["配置 GitHub OAuth App",e.jsxs(De.Subheader,{children:["用以支持通过 GitHub 进行登录注册，",e.jsx("a",{href:"https://github.com/settings/developers",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 GitHub OAuth App"]})]}),e.jsxs(Bu,{children:["Homepage URL 填 ",e.jsx("code",{children:u.ServerAddress}),"，Authorization callback URL 填"," ",e.jsx("code",{children:`${u.ServerAddress}/oauth/github`})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"GitHub Client ID",name:"GitHubClientId",onChange:$,autoComplete:"new-password",value:u.GitHubClientId,placeholder:"输入你注册的 GitHub OAuth APP 的 ID"}),e.jsx(G.Input,{label:"GitHub Client Secret",name:"GitHubClientSecret",onChange:$,type:"password",autoComplete:"new-password",value:u.GitHubClientSecret,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(G.Button,{onClick:L,children:"保存 GitHub OAuth 设置"}),e.jsx(_e,{}),e.jsxs(De,{as:"h3",inverted:_,children:["配置 WeChat Server",e.jsxs(De.Subheader,{children:["用以支持通过微信进行登录注册，",e.jsx("a",{href:"https://github.com/songquanpeng/wechat-server",target:"_blank",rel:"noreferrer",children:"点击此处"}),"了解 WeChat Server"]})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"WeChat Server 服务器地址",name:"WeChatServerAddress",placeholder:"例如：https://yourdomain.com",onChange:$,autoComplete:"new-password",value:u.WeChatServerAddress}),e.jsx(G.Input,{label:"WeChat Server 访问凭证",name:"WeChatServerToken",type:"password",onChange:$,autoComplete:"new-password",value:u.WeChatServerToken,placeholder:"敏感信息不会发送到前端显示"}),e.jsx(G.Input,{label:"微信公众号二维码图片链接",name:"WeChatAccountQRCodeImageURL",onChange:$,autoComplete:"new-password",value:u.WeChatAccountQRCodeImageURL,placeholder:"输入一个图片链接"})]}),e.jsx(G.Button,{onClick:Z,children:"保存 WeChat Server 设置"}),e.jsx(_e,{}),e.jsx(De,{as:"h3",inverted:_,children:"配置 Telegram 登录"}),e.jsxs(G.Group,{inline:!0,children:[e.jsx(G.Input,{label:"Telegram Bot Token",name:"TelegramBotToken",onChange:$,value:u.TelegramBotToken,placeholder:"输入你的 Telegram Bot Token"}),e.jsx(G.Input,{label:"Telegram Bot 名称",name:"TelegramBotName",onChange:$,value:u.TelegramBotName,placeholder:"输入你的 Telegram Bot 名称"})]}),e.jsx(G.Button,{onClick:ne,children:"保存 Telegram 登录设置"}),e.jsx(_e,{}),e.jsxs(De,{as:"h3",inverted:_,children:["配置 Turnstile",e.jsxs(De.Subheader,{children:["用以支持用户校验，",e.jsx("a",{href:"https://dash.cloudflare.com/",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 Turnstile Sites，推荐选择 Invisible Widget Type"]})]}),e.jsxs(G.Group,{widths:3,children:[e.jsx(G.Input,{label:"Turnstile Site Key",name:"TurnstileSiteKey",onChange:$,autoComplete:"new-password",value:u.TurnstileSiteKey,placeholder:"输入你注册的 Turnstile Site Key"}),e.jsx(G.Input,{label:"Turnstile Secret Key",name:"TurnstileSecretKey",onChange:$,type:"password",autoComplete:"new-password",value:u.TurnstileSecretKey,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(G.Button,{onClick:re,children:"保存 Turnstile 设置"})]})})})},Pn=()=>{let[u,n]=t.useState({Notice:"",SystemName:"",Logo:"",Footer:"",About:"",HomePageContent:""}),[i,s]=t.useState(!1);t.useState(!1),t.useState({tag_name:"",content:""});const r=async(S,q)=>{s(!0);const H=await P.put("/api/option/",{key:S,value:q}),{success:te,message:Y}=H.data;te?n(Z=>({...Z,[S]:q})):C(Y),s(!1)},[a,h]=t.useState({Notice:!1,SystemName:!1,Logo:!1,HomePageContent:!1,About:!1,Footer:!1}),y=async(S,q)=>{const H=q.target.id;n(te=>({...te,[H]:S}))},w=t.useRef(),d=async()=>{try{h(S=>({...S,Notice:!0})),await r("Notice",u.Notice),X("公告已更新")}catch(S){console.error("公告更新失败",S),C("公告更新失败")}finally{h(S=>({...S,Notice:!1}))}},l=t.useRef(),F=async()=>{try{h(S=>({...S,SystemName:!0})),await r("SystemName",u.SystemName),X("系统名称已更新")}catch(S){console.error("系统名称更新失败",S),C("系统名称更新失败")}finally{h(S=>({...S,SystemName:!1}))}},x=async()=>{try{h(S=>({...S,Logo:!0})),await r("Logo",u.Logo),X("Logo 已更新")}catch(S){console.error("Logo 更新失败",S),C("Logo 更新失败")}finally{h(S=>({...S,Logo:!1}))}},_=async S=>{try{h(q=>({...q,HomePageContent:!0})),await r(S,u[S]),X("首页内容已更新")}catch(q){console.error("首页内容更新失败",q),C("首页内容更新失败")}finally{h(q=>({...q,HomePageContent:!1}))}},M=async()=>{try{h(S=>({...S,About:!0})),await r("About",u.About),X("关于内容已更新")}catch(S){console.error("关于内容更新失败",S),C("关于内容更新失败")}finally{h(S=>({...S,About:!1}))}},I=async()=>{try{h(S=>({...S,Footer:!0})),await r("Footer",u.Footer),X("页脚内容已更新")}catch(S){console.error("页脚内容更新失败",S),C("页脚内容更新失败")}finally{h(S=>({...S,Footer:!1}))}},$=async()=>{const S=await P.get("/api/option/"),{success:q,message:H,data:te}=S.data;if(q){let Y={};te.forEach(Z=>{Z.key in u&&(Y[Z.key]=Z.value)}),n(Y),w.current.setValues(Y),l.current.setValues(Y)}else C(H)};return t.useEffect(()=>{$()},[]),e.jsx(Ee,{children:e.jsxs(he,{span:24,children:[e.jsx(N,{values:u,getFormApi:S=>w.current=S,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"通用设置",children:[e.jsx(N.TextArea,{label:"公告",placeholder:"在此输入新的公告内容，支持 Markdown & HTML 代码",field:"Notice",onChange:y,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(T,{onClick:d,loading:a.Notice,children:"设置公告"})]})}),e.jsx(N,{values:u,getFormApi:S=>l.current=S,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"个性化设置",children:[e.jsx(N.Input,{label:"系统名称",placeholder:"在此输入系统名称",field:"SystemName",onChange:y}),e.jsx(T,{onClick:F,loading:a.SystemName,children:"设置系统名称"}),e.jsx(N.Input,{label:"Logo 图片地址",placeholder:"在此输入 Logo 图片地址",field:"Logo",onChange:y}),e.jsx(T,{onClick:x,loading:a.Logo,children:"设置 Logo"}),e.jsx(N.TextArea,{label:"首页内容",placeholder:"在此输入首页内容，支持 Markdown & HTML 代码，设置后首页的状态信息将不再显示。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为首页。",field:"HomePageContent",onChange:y,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(T,{onClick:()=>_("HomePageContent"),loading:a.HomePageContent,children:"设置首页内容"}),e.jsx(N.TextArea,{label:"关于",placeholder:"在此输入新的关于内容，支持 Markdown & HTML 代码。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为关于页面。",field:"About",onChange:y,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(T,{onClick:M,loading:a.About,children:"设置关于"}),e.jsx(Ue,{fullMode:!1,type:"info",description:"移除 One API 的版权标识必须首先获得授权，项目维护需要花费大量精力，如果本项目对你有意义，请主动支持本项目。",closeIcon:null,style:{marginTop:15}}),e.jsx(N.Input,{label:"页脚",placeholder:"在此输入新的页脚，留空则使用默认页脚，支持 HTML 代码",field:"Footer",onChange:y}),e.jsx(T,{onClick:I,loading:a.Footer,children:"设置页脚"})]})})]})})},Mn=()=>{var au,xu,k,O,ie,oe,pe,je,Oe,Xe,Eu;const[u,n]=t.useContext(Ze);let i=Re();const[s,r]=t.useState({wechat_verification_code:"",email_verification_code:"",email:"",self_account_deletion_confirmation:"",set_new_password:"",set_new_password_confirmation:""}),[a,h]=t.useState({}),[y,w]=t.useState(!1),[d,l]=t.useState(!1),[F,x]=t.useState(!1),[_,M]=t.useState(!1),[I,$]=t.useState(!1),[S,q]=t.useState(""),[H,te]=t.useState(""),[Y,Z]=t.useState(!1),[L,ne]=t.useState(!1),[re,b]=t.useState(30),[p,g]=t.useState(""),[R,E]=t.useState(""),[B,c]=t.useState([]),[f,v]=t.useState(!1),[U,o]=t.useState(0);t.useEffect(()=>{let Q=localStorage.getItem("status");Q&&(Q=JSON.parse(Q),h(Q),Q.turnstile_check&&($(!0),q(Q.turnstile_site_key))),ee().then(Ce=>{console.log(u)}),j().then(),W().then(),o(ju())},[]),t.useEffect(()=>{let Q=null;return L&&re>0?Q=setInterval(()=>{b(re-1)},1e3):re===0&&(ne(!1),b(30)),()=>clearInterval(Q)},[L,re]);const m=(Q,Ce)=>{r(fe=>({...fe,[Q]:Ce}))},D=async()=>{const Q=await P.get("/api/user/token"),{success:Ce,message:fe,data:Ne}=Q.data;Ce?(E(Ne),await ze(Ne),X("令牌已重置并已复制到剪贴板")):C(fe)},W=async()=>{const Q=await P.get("/api/user/aff"),{success:Ce,message:fe,data:Ne}=Q.data;if(Ce){let jt=`${window.location.origin}/register?aff=${Ne}`;g(jt)}else C(fe)},ee=async()=>{let Q=await P.get("/api/user/self");const{success:Ce,message:fe,data:Ne}=Q.data;Ce?n({type:"login",payload:Ne}):C(fe)},j=async()=>{let Q=await P.get("/api/user/models");const{success:Ce,message:fe,data:Ne}=Q.data;Ce?(c(Ne),console.log(Ne)):C(fe)},K=async Q=>{Q.target.select(),await ze(Q.target.value),X("邀请链接已复制到剪切板")},ae=async Q=>{Q.target.select(),await ze(Q.target.value),X("系统令牌已复制到剪切板")},A=async()=>{if(s.self_account_deletion_confirmation!==u.user.username){C("请输入你的账户名以确认删除！");return}const Q=await P.delete("/api/user/self"),{success:Ce,message:fe}=Q.data;Ce?(X("账户已删除！"),await P.get("/api/user/logout"),n({type:"logout"}),localStorage.removeItem("user"),i("/login")):C(fe)},J=async()=>{if(s.wechat_verification_code==="")return;const Q=await P.get(`/api/oauth/wechat/bind?code=${s.wechat_verification_code}`),{success:Ce,message:fe}=Q.data;Ce?(X("微信账户绑定成功！"),l(!1)):C(fe)},V=async()=>{if(s.set_new_password!==s.set_new_password_confirmation){C("两次输入的密码不一致！");return}const Q=await P.put("/api/user/self",{password:s.set_new_password}),{success:Ce,message:fe}=Q.data;Ce?(X("密码修改成功！"),l(!1)):C(fe),w(!1)},se=async()=>{if(U<ju()){C("划转金额最低为"+xe(ju()));return}const Q=await P.post("/api/user/aff_transfer",{quota:U}),{success:Ce,message:fe}=Q.data;Ce?(X(fe),v(!1),ee().then()):C(fe)},me=async()=>{if(s.email===""){C("请输入邮箱！");return}if(ne(!0),I&&H===""){Se("请稍后几秒重试，Turnstile 正在检查用户环境！");return}Z(!0);const Q=await P.get(`/api/verification?email=${s.email}&turnstile=${H}`),{success:Ce,message:fe}=Q.data;Ce?X("验证码发送成功，请检查邮箱！"):C(fe),Z(!1)},be=async()=>{if(s.email_verification_code===""){C("请输入邮箱验证码！");return}Z(!0);const Q=await P.get(`/api/oauth/email/bind?email=${s.email}&code=${s.email_verification_code}`),{success:Ce,message:fe}=Q.data;Ce?(X("邮箱账户绑定成功！"),x(!1),u.user.email=s.email):C(fe),Z(!1)},Te=()=>u.user?u.user.username:"null",Ke=()=>{v(!1)},su=async Q=>{await ze(Q)?X("已复制："+Q):ye.error({title:"无法复制到剪贴板，请手动复制",content:Q})};return e.jsx("div",{children:e.jsx(ce,{children:e.jsxs(ce.Content,{children:[e.jsxs(ye,{title:"请输入要划转的数量",visible:f,onOk:se,onCancel:Ke,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("div",{style:{marginTop:20},children:[e.jsx(ue.Text,{children:`可用额度${hu((au=u==null?void 0:u.user)==null?void 0:au.aff_quota)}`}),e.jsx(le,{style:{marginTop:5},value:(xu=u==null?void 0:u.user)==null?void 0:xu.aff_quota,disabled:!0})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(ue.Text,{children:`划转额度${hu(U)} 最低`+xe(ju())}),e.jsx("div",{children:e.jsx(Tu,{min:0,style:{marginTop:5},value:U,onChange:Q=>o(Q),disabled:!1})})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsxs(we,{title:e.jsx(we.Meta,{avatar:e.jsx(zu,{size:"default",color:Fu(Te()),style:{marginRight:4},children:typeof Te()=="string"&&Te().slice(0,1)}),title:e.jsx(ue.Text,{children:Te()}),description:ct()?e.jsx(z,{color:"red",children:"管理员"}):e.jsx(z,{color:"blue",children:"普通用户"})}),headerExtraContent:e.jsx(e.Fragment,{children:e.jsxs(de,{vertical:!0,align:"start",children:[e.jsx(z,{color:"green",children:"ID: "+((k=u==null?void 0:u.user)==null?void 0:k.id)}),e.jsx(z,{color:"blue",children:(O=u==null?void 0:u.user)==null?void 0:O.group})]})}),footer:e.jsxs(Ge,{row:!0,children:[e.jsx(Ge.Item,{itemKey:"当前余额",children:xe((ie=u==null?void 0:u.user)==null?void 0:ie.quota)}),e.jsx(Ge.Item,{itemKey:"历史消耗",children:xe((oe=u==null?void 0:u.user)==null?void 0:oe.used_quota)}),e.jsx(Ge.Item,{itemKey:"请求次数",children:(pe=u.user)==null?void 0:pe.request_count})]}),children:[e.jsx(ue.Title,{heading:6,children:"可用模型"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(de,{wrap:!0,children:B.map(Q=>e.jsx(z,{color:"cyan",onClick:()=>{su(Q)},children:Q},Q))})})]}),e.jsxs(we,{footer:e.jsxs("div",{children:[e.jsx(ue.Text,{children:"邀请链接"}),e.jsx(le,{style:{marginTop:10},value:p,onClick:K,readOnly:!0})]}),children:[e.jsx(ue.Title,{heading:6,children:"邀请信息"}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(Ge,{row:!0,children:[e.jsxs(Ge.Item,{itemKey:"待使用收益",children:[e.jsx("span",{style:{color:"rgba(var(--semi-red-5), 1)"},children:xe((je=u==null?void 0:u.user)==null?void 0:je.aff_quota)}),e.jsx(T,{type:"secondary",onClick:()=>v(!0),size:"small",style:{marginLeft:10},children:"划转"})]}),e.jsx(Ge.Item,{itemKey:"总收益",children:xe((Oe=u==null?void 0:u.user)==null?void 0:Oe.aff_history_quota)}),e.jsx(Ge.Item,{itemKey:"邀请人数",children:(Xe=u==null?void 0:u.user)==null?void 0:Xe.aff_count})]})})]}),e.jsxs(we,{children:[e.jsx(ue.Title,{heading:6,children:"个人信息"}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(ue.Text,{strong:!0,children:"邮箱"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(le,{value:u.user&&u.user.email!==""?u.user.email:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(T,{onClick:()=>{x(!0)},children:u.user&&u.user.email!==""?"修改绑定":"绑定邮箱"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(ue.Text,{strong:!0,children:"微信"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(le,{value:u.user&&u.user.wechat_id!==""?"已绑定":"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(T,{disabled:u.user&&u.user.wechat_id!==""||!a.wechat_login,children:a.wechat_login?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(ue.Text,{strong:!0,children:"GitHub"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(le,{value:u.user&&u.user.github_id!==""?u.user.github_id:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(T,{onClick:()=>{pt(a.github_client_id)},disabled:u.user&&u.user.github_id!==""||!a.github_oauth,children:a.github_oauth?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(ue.Text,{strong:!0,children:"Telegram"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(le,{value:u.user&&u.user.telegram_id!==""?u.user.telegram_id:"未绑定",readonly:!0})}),e.jsx("div",{children:a.telegram_oauth?u.user.telegram_id!==""?e.jsx(T,{disabled:!0,children:"已绑定"}):e.jsx(it,{dataAuthUrl:"/api/oauth/telegram/bind",botName:a.telegram_bot_name}):e.jsx(T,{disabled:!0,children:"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(de,{children:[e.jsx(T,{onClick:D,children:"生成系统访问令牌"}),e.jsx(T,{onClick:()=>{w(!0)},children:"修改密码"}),e.jsx(T,{type:"danger",onClick:()=>{M(!0)},children:"删除个人账户"})]}),R&&e.jsx(le,{readOnly:!0,value:R,onClick:ae,style:{marginTop:"10px"}}),a.wechat_login&&e.jsx(T,{onClick:()=>{l(!0)},children:"绑定微信账号"}),e.jsxs(ye,{onCancel:()=>l(!1),visible:d,size:"small",children:[e.jsx(kt,{src:a.wechat_qrcode}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(le,{placeholder:"验证码",name:"wechat_verification_code",value:s.wechat_verification_code,onChange:Q=>m("wechat_verification_code",Q)}),e.jsx(T,{color:"",fluid:!0,size:"large",onClick:J,children:"绑定"})]})]})]}),e.jsxs(ye,{onCancel:()=>x(!1),onOk:be,visible:F,size:"small",centered:!0,maskClosable:!1,children:[e.jsx(ue.Title,{heading:6,children:"绑定邮箱地址"}),e.jsxs("div",{style:{marginTop:20,display:"flex",justifyContent:"space-between"},children:[e.jsx(le,{fluid:!0,placeholder:"输入邮箱地址",onChange:Q=>m("email",Q),name:"email",type:"email"}),e.jsx(T,{onClick:me,disabled:L||Y,children:L?`重新发送 (${re})`:"获取验证码"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(le,{fluid:!0,placeholder:"验证码",name:"email_verification_code",value:s.email_verification_code,onChange:Q=>m("email_verification_code",Q)})}),I?e.jsx(ou,{sitekey:S,onVerify:Q=>{te(Q)}}):e.jsx(e.Fragment,{})]}),e.jsxs(ye,{onCancel:()=>M(!1),visible:_,size:"small",centered:!0,onOk:A,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Ue,{type:"danger",description:"您正在删除自己的帐户，将清空所有数据且不可恢复",closeIcon:null})}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(le,{placeholder:`输入你的账户名 ${(Eu=u==null?void 0:u.user)==null?void 0:Eu.username} 以确认删除`,name:"self_account_deletion_confirmation",value:s.self_account_deletion_confirmation,onChange:Q=>m("self_account_deletion_confirmation",Q)}),I?e.jsx(ou,{sitekey:S,onVerify:Q=>{te(Q)}}):e.jsx(e.Fragment,{})]})]}),e.jsx(ye,{onCancel:()=>w(!1),visible:y,size:"small",centered:!0,onOk:V,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx(le,{name:"set_new_password",placeholder:"新密码",value:s.set_new_password,onChange:Q=>m("set_new_password",Q)}),e.jsx(le,{style:{marginTop:20},name:"set_new_password_confirmation",placeholder:"确认新密码",value:s.set_new_password_confirmation,onChange:Q=>m("set_new_password_confirmation",Q)}),I?e.jsx(ou,{sitekey:S,onVerify:Q=>{te(Q)}}):e.jsx(e.Fragment,{})]})})]})]})})})};function $n(u){const[n,i]=t.useState(!1),[s,r]=t.useState({TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:"",RetryTimes:"",DisplayInCurrencyEnabled:!1,DisplayTokenStatEnabled:!1,DefaultCollapseSidebar:!1}),a=t.useRef(),[h,y]=t.useState(s);function w(l,F){const x=F.target.id;r(_=>({..._,[x]:l}))}function d(){const l=Ye(s,h);if(!l.length)return Je("你似乎并没有修改什么");const F=l.map(x=>{let _="";return typeof s[x.key]=="boolean"?_=String(s[x.key]):_=s[x.key],P.put("/api/option/",{key:x.key,value:_})});i(!0),Promise.all(F).then(x=>{if(F.length===1){if(x.includes(void 0))return}else if(F.length>1&&x.includes(void 0))return C("部分保存失败，请重试");X("保存成功"),u.refresh()}).catch(()=>{C("保存失败，请重试")}).finally(()=>{i(!1)})}return t.useEffect(()=>{const l={};for(let F in u.options)Object.keys(s).includes(F)&&(l[F]=u.options[F]);r(l),y(structuredClone(l)),a.current.setValues(l)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(Ae,{spinning:n,children:e.jsx(N,{values:s,getFormApi:l=>a.current=l,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"通用设置",children:[e.jsxs(Ee,{gutter:16,children:[e.jsx(he,{span:8,children:e.jsx(N.Input,{field:"TopUpLink",label:"充值链接",initValue:"",placeholder:"例如发卡网站的购买链接",onChange:w,showClear:!0})}),e.jsx(he,{span:8,children:e.jsx(N.Input,{field:"ChatLink",label:"默认聊天页面链接",initValue:"",placeholder:"例如 ChatGPT Next Web 的部署地址",onChange:w,showClear:!0})}),e.jsx(he,{span:8,children:e.jsx(N.Input,{field:"ChatLink2",label:"聊天页面 2 链接",initValue:"",placeholder:"例如 ChatGPT Next Web 的部署地址",onChange:w,showClear:!0})}),e.jsx(he,{span:8,children:e.jsx(N.Input,{field:"QuotaPerUnit",label:"单位美元额度",initValue:"",placeholder:"一单位货币能兑换的额度",onChange:w,showClear:!0})}),e.jsx(he,{span:8,children:e.jsx(N.Input,{field:"RetryTimes",label:"失败重试次数",initValue:"",placeholder:"失败重试次数",onChange:w,showClear:!0})})]}),e.jsxs(Ee,{gutter:16,children:[e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"DisplayInCurrencyEnabled",label:"以货币形式显示额度",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:l=>{r({...s,DisplayInCurrencyEnabled:l})}})}),e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"DisplayTokenStatEnabled",label:"Billing 相关 API 显示令牌额度而非用户额度",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:l=>r({...s,DisplayTokenStatEnabled:l})})}),e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"DefaultCollapseSidebar",label:"默认折叠侧边栏",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:l=>r({...s,DefaultCollapseSidebar:l})})})]}),e.jsx(Ee,{children:e.jsx(T,{size:"large",onClick:d,children:"保存通用设置"})})]})})})})}function Rn(u){const[n,i]=t.useState(!1),[s,r]=t.useState({DrawingEnabled:!1,MjNotifyEnabled:!1,MjAccountFilterEnabled:!1,MjForwardUrlEnabled:!1,MjModeClearEnabled:!1}),a=t.useRef(),[h,y]=t.useState(s);function w(){const d=Ye(s,h);if(!d.length)return Je("你似乎并没有修改什么");const l=d.map(F=>{let x="";return typeof s[F.key]=="boolean"?x=String(s[F.key]):x=s[F.key],P.put("/api/option/",{key:F.key,value:x})});i(!0),Promise.all(l).then(F=>{if(l.length===1){if(F.includes(void 0))return}else if(l.length>1&&F.includes(void 0))return C("部分保存失败，请重试");X("保存成功"),u.refresh()}).catch(()=>{C("保存失败，请重试")}).finally(()=>{i(!1)})}return t.useEffect(()=>{const d={};for(let l in u.options)Object.keys(s).includes(l)&&(d[l]=u.options[l]);r(d),y(structuredClone(d)),a.current.setValues(d),localStorage.setItem("mj_notify_enabled",String(s.MjNotifyEnabled))},[u.options]),e.jsx(e.Fragment,{children:e.jsx(Ae,{spinning:n,children:e.jsx(N,{values:s,getFormApi:d=>a.current=d,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"绘图设置",children:[e.jsxs(Ee,{gutter:16,children:[e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"DrawingEnabled",label:"启用绘图功能",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>{r({...s,DrawingEnabled:d})}})}),e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"MjNotifyEnabled",label:"允许回调（会泄露服务器 IP 地址）",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>r({...s,MjNotifyEnabled:d})})}),e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"MjAccountFilterEnabled",label:"允许 AccountFilter 参数",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>r({...s,MjAccountFilterEnabled:d})})}),e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"MjForwardUrlEnabled",label:"开启之后将上游地址替换为服务器地址",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>r({...s,MjForwardUrlEnabled:d})})}),e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"MjModeClearEnabled",label:e.jsxs(e.Fragment,{children:["开启之后会清除用户提示词中的 ",e.jsx(z,{children:"--fast"})," 、",e.jsx(z,{children:"--relax"})," 以及 ",e.jsx(z,{children:"--turbo"})," 参数"]}),size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>r({...s,MjModeClearEnabled:d})})})]}),e.jsx(Ee,{children:e.jsx(T,{size:"large",onClick:w,children:"保存绘图设置"})})]})})})})}function On(u){const[n,i]=t.useState(!1),[s,r]=t.useState({CheckSensitiveEnabled:!1,CheckSensitiveOnPromptEnabled:!1,SensitiveWords:""}),a=t.useRef(),[h,y]=t.useState(s);function w(){const d=Ye(s,h);if(!d.length)return Je("你似乎并没有修改什么");const l=d.map(F=>{let x="";return typeof s[F.key]=="boolean"?x=String(s[F.key]):x=s[F.key],P.put("/api/option/",{key:F.key,value:x})});i(!0),Promise.all(l).then(F=>{if(l.length===1){if(F.includes(void 0))return}else if(l.length>1&&F.includes(void 0))return C("部分保存失败，请重试");X("保存成功"),u.refresh()}).catch(()=>{C("保存失败，请重试")}).finally(()=>{i(!1)})}return t.useEffect(()=>{const d={};for(let l in u.options)Object.keys(s).includes(l)&&(d[l]=u.options[l]);r(d),y(structuredClone(d)),a.current.setValues(d)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(Ae,{spinning:n,children:e.jsx(N,{values:s,getFormApi:d=>a.current=d,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"屏蔽词过滤设置",children:[e.jsxs(Ee,{gutter:16,children:[e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"CheckSensitiveEnabled",label:"启用屏蔽词过滤功能",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>{r({...s,CheckSensitiveEnabled:d})}})}),e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"CheckSensitiveOnPromptEnabled",label:"启用 Prompt 检查",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>r({...s,CheckSensitiveOnPromptEnabled:d})})})]}),e.jsx(Ee,{children:e.jsx(he,{span:16,children:e.jsx(N.TextArea,{label:"屏蔽词列表",extraText:"一行一个屏蔽词，不需要符号分割",placeholder:"一行一个屏蔽词，不需要符号分割",field:"SensitiveWords",onChange:d=>r({...s,SensitiveWords:d}),style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}})})}),e.jsx(Ee,{children:e.jsx(T,{size:"large",onClick:w,children:"保存屏蔽词过滤设置"})})]})})})})}var Et={exports:{}};(function(u,n){(function(i,s){u.exports=s()})(Bt,function(){var i=1e3,s=6e4,r=36e5,a="millisecond",h="second",y="minute",w="hour",d="day",l="week",F="month",x="quarter",_="year",M="date",I="Invalid Date",$=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,S=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,q={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(E){var B=["th","st","nd","rd"],c=E%100;return"["+E+(B[(c-20)%10]||B[c]||B[0])+"]"}},H=function(E,B,c){var f=String(E);return!f||f.length>=B?E:""+Array(B+1-f.length).join(c)+E},te={s:H,z:function(E){var B=-E.utcOffset(),c=Math.abs(B),f=Math.floor(c/60),v=c%60;return(B<=0?"+":"-")+H(f,2,"0")+":"+H(v,2,"0")},m:function E(B,c){if(B.date()<c.date())return-E(c,B);var f=12*(c.year()-B.year())+(c.month()-B.month()),v=B.clone().add(f,F),U=c-v<0,o=B.clone().add(f+(U?-1:1),F);return+(-(f+(c-v)/(U?v-o:o-v))||0)},a:function(E){return E<0?Math.ceil(E)||0:Math.floor(E)},p:function(E){return{M:F,y:_,w:l,d,D:M,h:w,m:y,s:h,ms:a,Q:x}[E]||String(E||"").toLowerCase().replace(/s$/,"")},u:function(E){return E===void 0}},Y="en",Z={};Z[Y]=q;var L="$isDayjsObject",ne=function(E){return E instanceof g||!(!E||!E[L])},re=function E(B,c,f){var v;if(!B)return Y;if(typeof B=="string"){var U=B.toLowerCase();Z[U]&&(v=U),c&&(Z[U]=c,v=U);var o=B.split("-");if(!v&&o.length>1)return E(o[0])}else{var m=B.name;Z[m]=B,v=m}return!f&&v&&(Y=v),v||!f&&Y},b=function(E,B){if(ne(E))return E.clone();var c=typeof B=="object"?B:{};return c.date=E,c.args=arguments,new g(c)},p=te;p.l=re,p.i=ne,p.w=function(E,B){return b(E,{locale:B.$L,utc:B.$u,x:B.$x,$offset:B.$offset})};var g=function(){function E(c){this.$L=re(c.locale,null,!0),this.parse(c),this.$x=this.$x||c.x||{},this[L]=!0}var B=E.prototype;return B.parse=function(c){this.$d=function(f){var v=f.date,U=f.utc;if(v===null)return new Date(NaN);if(p.u(v))return new Date;if(v instanceof Date)return new Date(v);if(typeof v=="string"&&!/Z$/i.test(v)){var o=v.match($);if(o){var m=o[2]-1||0,D=(o[7]||"0").substring(0,3);return U?new Date(Date.UTC(o[1],m,o[3]||1,o[4]||0,o[5]||0,o[6]||0,D)):new Date(o[1],m,o[3]||1,o[4]||0,o[5]||0,o[6]||0,D)}}return new Date(v)}(c),this.init()},B.init=function(){var c=this.$d;this.$y=c.getFullYear(),this.$M=c.getMonth(),this.$D=c.getDate(),this.$W=c.getDay(),this.$H=c.getHours(),this.$m=c.getMinutes(),this.$s=c.getSeconds(),this.$ms=c.getMilliseconds()},B.$utils=function(){return p},B.isValid=function(){return this.$d.toString()!==I},B.isSame=function(c,f){var v=b(c);return this.startOf(f)<=v&&v<=this.endOf(f)},B.isAfter=function(c,f){return b(c)<this.startOf(f)},B.isBefore=function(c,f){return this.endOf(f)<b(c)},B.$g=function(c,f,v){return p.u(c)?this[f]:this.set(v,c)},B.unix=function(){return Math.floor(this.valueOf()/1e3)},B.valueOf=function(){return this.$d.getTime()},B.startOf=function(c,f){var v=this,U=!!p.u(f)||f,o=p.p(c),m=function(J,V){var se=p.w(v.$u?Date.UTC(v.$y,V,J):new Date(v.$y,V,J),v);return U?se:se.endOf(d)},D=function(J,V){return p.w(v.toDate()[J].apply(v.toDate("s"),(U?[0,0,0,0]:[23,59,59,999]).slice(V)),v)},W=this.$W,ee=this.$M,j=this.$D,K="set"+(this.$u?"UTC":"");switch(o){case _:return U?m(1,0):m(31,11);case F:return U?m(1,ee):m(0,ee+1);case l:var ae=this.$locale().weekStart||0,A=(W<ae?W+7:W)-ae;return m(U?j-A:j+(6-A),ee);case d:case M:return D(K+"Hours",0);case w:return D(K+"Minutes",1);case y:return D(K+"Seconds",2);case h:return D(K+"Milliseconds",3);default:return this.clone()}},B.endOf=function(c){return this.startOf(c,!1)},B.$set=function(c,f){var v,U=p.p(c),o="set"+(this.$u?"UTC":""),m=(v={},v[d]=o+"Date",v[M]=o+"Date",v[F]=o+"Month",v[_]=o+"FullYear",v[w]=o+"Hours",v[y]=o+"Minutes",v[h]=o+"Seconds",v[a]=o+"Milliseconds",v)[U],D=U===d?this.$D+(f-this.$W):f;if(U===F||U===_){var W=this.clone().set(M,1);W.$d[m](D),W.init(),this.$d=W.set(M,Math.min(this.$D,W.daysInMonth())).$d}else m&&this.$d[m](D);return this.init(),this},B.set=function(c,f){return this.clone().$set(c,f)},B.get=function(c){return this[p.p(c)]()},B.add=function(c,f){var v,U=this;c=Number(c);var o=p.p(f),m=function(ee){var j=b(U);return p.w(j.date(j.date()+Math.round(ee*c)),U)};if(o===F)return this.set(F,this.$M+c);if(o===_)return this.set(_,this.$y+c);if(o===d)return m(1);if(o===l)return m(7);var D=(v={},v[y]=s,v[w]=r,v[h]=i,v)[o]||1,W=this.$d.getTime()+c*D;return p.w(W,this)},B.subtract=function(c,f){return this.add(-1*c,f)},B.format=function(c){var f=this,v=this.$locale();if(!this.isValid())return v.invalidDate||I;var U=c||"YYYY-MM-DDTHH:mm:ssZ",o=p.z(this),m=this.$H,D=this.$m,W=this.$M,ee=v.weekdays,j=v.months,K=v.meridiem,ae=function(V,se,me,be){return V&&(V[se]||V(f,U))||me[se].slice(0,be)},A=function(V){return p.s(m%12||12,V,"0")},J=K||function(V,se,me){var be=V<12?"AM":"PM";return me?be.toLowerCase():be};return U.replace(S,function(V,se){return se||function(me){switch(me){case"YY":return String(f.$y).slice(-2);case"YYYY":return p.s(f.$y,4,"0");case"M":return W+1;case"MM":return p.s(W+1,2,"0");case"MMM":return ae(v.monthsShort,W,j,3);case"MMMM":return ae(j,W);case"D":return f.$D;case"DD":return p.s(f.$D,2,"0");case"d":return String(f.$W);case"dd":return ae(v.weekdaysMin,f.$W,ee,2);case"ddd":return ae(v.weekdaysShort,f.$W,ee,3);case"dddd":return ee[f.$W];case"H":return String(m);case"HH":return p.s(m,2,"0");case"h":return A(1);case"hh":return A(2);case"a":return J(m,D,!0);case"A":return J(m,D,!1);case"m":return String(D);case"mm":return p.s(D,2,"0");case"s":return String(f.$s);case"ss":return p.s(f.$s,2,"0");case"SSS":return p.s(f.$ms,3,"0");case"Z":return o}return null}(V)||o.replace(":","")})},B.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},B.diff=function(c,f,v){var U,o=this,m=p.p(f),D=b(c),W=(D.utcOffset()-this.utcOffset())*s,ee=this-D,j=function(){return p.m(o,D)};switch(m){case _:U=j()/12;break;case F:U=j();break;case x:U=j()/3;break;case l:U=(ee-W)/6048e5;break;case d:U=(ee-W)/864e5;break;case w:U=ee/r;break;case y:U=ee/s;break;case h:U=ee/i;break;default:U=ee}return v?U:p.a(U)},B.daysInMonth=function(){return this.endOf(F).$D},B.$locale=function(){return Z[this.$L]},B.locale=function(c,f){if(!c)return this.$L;var v=this.clone(),U=re(c,f,!0);return U&&(v.$L=U),v},B.clone=function(){return p.w(this.$d,this)},B.toDate=function(){return new Date(this.valueOf())},B.toJSON=function(){return this.isValid()?this.toISOString():null},B.toISOString=function(){return this.$d.toISOString()},B.toString=function(){return this.$d.toUTCString()},E}(),R=g.prototype;return b.prototype=R,[["$ms",a],["$s",h],["$m",y],["$H",w],["$W",d],["$M",F],["$y",_],["$D",M]].forEach(function(E){R[E[1]]=function(B){return this.$g(B,E[0],E[1])}}),b.extend=function(E,B){return E.$i||(E(B,g,b),E.$i=!0),b},b.locale=re,b.isDayjs=ne,b.unix=function(E){return b(1e3*E)},b.en=Z[Y],b.Ls=Z,b.p={},b})})(Et);var zn=Et.exports;const Ln=At(zn);function Nn(u){const[n,i]=t.useState(!1),[s,r]=t.useState(!1),[a,h]=t.useState({LogConsumeEnabled:!1,historyTimestamp:Ln().subtract(1,"month").toDate()}),y=t.useRef(),[w,d]=t.useState(a);function l(){const x=Ye(a,w).filter(M=>M.key!=="historyTimestamp");if(!x.length)return Je("你似乎并没有修改什么");const _=x.map(M=>{let I="";return typeof a[M.key]=="boolean"?I=String(a[M.key]):I=a[M.key],P.put("/api/option/",{key:M.key,value:I})});i(!0),Promise.all(_).then(M=>{if(_.length===1){if(M.includes(void 0))return}else if(_.length>1&&M.includes(void 0))return C("部分保存失败，请重试");X("保存成功"),u.refresh()}).catch(()=>{C("保存失败，请重试")}).finally(()=>{i(!1)})}async function F(){try{if(r(!0),!a.historyTimestamp)throw new Error("请选择日志记录时间");const x=await P.delete(`/api/log/?target_timestamp=${Date.parse(a.historyTimestamp)/1e3}`),{success:_,message:M,data:I}=x.data;if(_){X(`${I} 条日志已清理！`);return}else throw new Error("日志清理失败："+M)}catch(x){C(x.message)}finally{r(!1)}}return t.useEffect(()=>{const x={};for(let _ in u.options)Object.keys(a).includes(_)&&(x[_]=u.options[_]);x.historyTimestamp=a.historyTimestamp,h(Object.assign(a,x)),d(structuredClone(x)),y.current.setValues(x)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(Ae,{spinning:n,children:e.jsx(N,{values:a,getFormApi:x=>y.current=x,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"日志设置",children:[e.jsxs(Ee,{gutter:16,children:[e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"LogConsumeEnabled",label:"启用额度消费日志记录",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:x=>{h({...a,LogConsumeEnabled:x})}})}),e.jsx(he,{span:8,children:e.jsxs(Ae,{spinning:s,children:[e.jsx(N.DatePicker,{label:"日志记录时间",field:"historyTimestamp",type:"dateTime",inputReadOnly:!0,onChange:x=>{h({...a,historyTimestamp:x})}}),e.jsx(T,{size:"default",onClick:F,children:"清除历史日志"})]})})]}),e.jsx(Ee,{children:e.jsx(T,{size:"large",onClick:l,children:"保存日志设置"})})]})})})})}function Wn(u){const n=[{key:"hour",label:"小时",value:"hour"},{key:"day",label:"天",value:"day"},{key:"week",label:"周",value:"week"}],[i,s]=t.useState(!1),[r,a]=t.useState({DataExportEnabled:!1,DataExportInterval:"",DataExportDefaultTime:""}),h=t.useRef(),[y,w]=t.useState(r);function d(){const l=Ye(r,y);if(!l.length)return Je("你似乎并没有修改什么");const F=l.map(x=>{let _="";return typeof r[x.key]=="boolean"?_=String(r[x.key]):_=r[x.key],P.put("/api/option/",{key:x.key,value:_})});s(!0),Promise.all(F).then(x=>{if(F.length===1){if(x.includes(void 0))return}else if(F.length>1&&x.includes(void 0))return C("部分保存失败，请重试");X("保存成功"),u.refresh()}).catch(()=>{C("保存失败，请重试")}).finally(()=>{s(!1)})}return t.useEffect(()=>{const l={};for(let F in u.options)Object.keys(r).includes(F)&&(l[F]=u.options[F]);a(l),w(structuredClone(l)),h.current.setValues(l),localStorage.setItem("data_export_default_time",String(r.DataExportDefaultTime))},[u.options]),e.jsx(e.Fragment,{children:e.jsx(Ae,{spinning:i,children:e.jsx(N,{values:r,getFormApi:l=>h.current=l,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"数据看板设置",children:[e.jsx(Ee,{gutter:16,children:e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"DataExportEnabled",label:"启用数据看板（实验性）",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:l=>{a({...r,DataExportEnabled:l})}})})}),e.jsxs(Ee,{children:[e.jsx(he,{span:8,children:e.jsx(N.InputNumber,{label:"数据看板更新间隔 ",step:1,min:1,suffix:"分钟",extraText:"设置过短会影响数据库性能",placeholder:"数据看板更新间隔",field:"DataExportInterval",onChange:l=>a({...r,DataExportInterval:String(l)})})}),e.jsx(he,{span:8,children:e.jsx(N.Select,{label:"数据看板默认时间粒度",optionList:n,field:"DataExportDefaultTime",extraText:"仅修改展示粒度，统计精确到小时",placeholder:"数据看板默认时间粒度",style:{width:180},onChange:l=>a({...r,DataExportDefaultTime:String(l)})})})]}),e.jsx(Ee,{children:e.jsx(T,{size:"large",onClick:d,children:"保存数据看板设置"})})]})})})})}function Un(u){const[n,i]=t.useState(!1),[s,r]=t.useState({ChannelDisableThreshold:"",QuotaRemindThreshold:"",AutomaticDisableChannelEnabled:!1,AutomaticEnableChannelEnabled:!1}),a=t.useRef(),[h,y]=t.useState(s);function w(){const d=Ye(s,h);if(!d.length)return Je("你似乎并没有修改什么");const l=d.map(F=>{let x="";return typeof s[F.key]=="boolean"?x=String(s[F.key]):x=s[F.key],P.put("/api/option/",{key:F.key,value:x})});i(!0),Promise.all(l).then(F=>{if(l.length===1){if(F.includes(void 0))return}else if(l.length>1&&F.includes(void 0))return C("部分保存失败，请重试");X("保存成功"),u.refresh()}).catch(()=>{C("保存失败，请重试")}).finally(()=>{i(!1)})}return t.useEffect(()=>{const d={};for(let l in u.options)Object.keys(s).includes(l)&&(d[l]=u.options[l]);r(d),y(structuredClone(d)),a.current.setValues(d)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(Ae,{spinning:n,children:e.jsx(N,{values:s,getFormApi:d=>a.current=d,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"监控设置",children:[e.jsxs(Ee,{gutter:16,children:[e.jsx(he,{span:8,children:e.jsx(N.InputNumber,{label:"最长响应时间",step:1,min:0,suffix:"秒",extraText:"当运行通道全部测试时，超过此时间将自动禁用通道",placeholder:"",field:"ChannelDisableThreshold",onChange:d=>r({...s,ChannelDisableThreshold:String(d)})})}),e.jsx(he,{span:8,children:e.jsx(N.InputNumber,{label:"额度提醒阈值",step:1,min:0,suffix:"Token",extraText:"低于此额度时将发送邮件提醒用户",placeholder:"",field:"QuotaRemindThreshold",onChange:d=>r({...s,QuotaRemindThreshold:String(d)})})})]}),e.jsxs(Ee,{gutter:16,children:[e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"AutomaticDisableChannelEnabled",label:"失败时自动禁用通道",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>{r({...s,AutomaticDisableChannelEnabled:d})}})}),e.jsx(he,{span:8,children:e.jsx(N.Switch,{field:"AutomaticEnableChannelEnabled",label:"成功时自动启用通道",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:d=>r({...s,AutomaticEnableChannelEnabled:d})})})]}),e.jsx(Ee,{children:e.jsx(T,{size:"large",onClick:w,children:"保存监控设置"})})]})})})})}function Kn(u){const[n,i]=t.useState(!1),[s,r]=t.useState({QuotaForNewUser:"",PreConsumedQuota:"",QuotaForInviter:"",QuotaForInvitee:""}),a=t.useRef(),[h,y]=t.useState(s);function w(){const d=Ye(s,h);if(!d.length)return Je("你似乎并没有修改什么");const l=d.map(F=>{let x="";return typeof s[F.key]=="boolean"?x=String(s[F.key]):x=s[F.key],P.put("/api/option/",{key:F.key,value:x})});i(!0),Promise.all(l).then(F=>{if(l.length===1){if(F.includes(void 0))return}else if(l.length>1&&F.includes(void 0))return C("部分保存失败，请重试");X("保存成功"),u.refresh()}).catch(()=>{C("保存失败，请重试")}).finally(()=>{i(!1)})}return t.useEffect(()=>{const d={};for(let l in u.options)Object.keys(s).includes(l)&&(d[l]=u.options[l]);r(d),y(structuredClone(d)),a.current.setValues(d)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(Ae,{spinning:n,children:e.jsx(N,{values:s,getFormApi:d=>a.current=d,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"额度设置",children:[e.jsxs(Ee,{gutter:16,children:[e.jsx(he,{span:6,children:e.jsx(N.InputNumber,{label:"新用户初始额度",field:"QuotaForNewUser",step:1,min:0,suffix:"Token",placeholder:"",onChange:d=>r({...s,QuotaForNewUser:String(d)})})}),e.jsx(he,{span:6,children:e.jsx(N.InputNumber,{label:"请求预扣费额度",field:"PreConsumedQuota",step:1,min:0,suffix:"Token",extraText:"请求结束后多退少补",placeholder:"",onChange:d=>r({...s,PreConsumedQuota:String(d)})})}),e.jsx(he,{span:6,children:e.jsx(N.InputNumber,{label:"邀请新用户奖励额度",field:"QuotaForInviter",step:1,min:0,suffix:"Token",extraText:"",placeholder:"例如：2000",onChange:d=>r({...s,QuotaForInviter:String(d)})})}),e.jsx(he,{span:6,children:e.jsx(N.InputNumber,{label:"新用户使用邀请码奖励额度",field:"QuotaForInvitee",step:1,min:0,suffix:"Token",extraText:"",placeholder:"例如：1000",onChange:d=>r({...s,QuotaForInvitee:String(d)})})})]}),e.jsx(Ee,{children:e.jsx(T,{size:"large",onClick:w,children:"保存额度设置"})})]})})})})}function Gn(u){const[n,i]=t.useState(!1),[s,r]=t.useState({ModelPrice:"",ModelRatio:"",CompletionRatio:"",GroupRatio:""}),a=t.useRef(),[h,y]=t.useState(s);async function w(){try{console.log("Starting validation..."),await a.current.validate().then(()=>{console.log("Validation passed");const l=Ye(s,h);if(!l.length)return Je("你似乎并没有修改什么");const F=l.map(x=>{let _="";return typeof s[x.key]=="boolean"?_=String(s[x.key]):_=s[x.key],P.put("/api/option/",{key:x.key,value:_})});i(!0),Promise.all(F).then(x=>{if(F.length===1){if(x.includes(void 0))return}else if(F.length>1&&x.includes(void 0))return C("部分保存失败，请重试");X("保存成功"),u.refresh()}).catch(()=>{C("保存失败，请重试")}).finally(()=>{i(!1)})}).catch(l=>{console.error("Validation failed:",l),C("请检查输入")})}catch(l){C("请检查输入"),console.error(l)}}async function d(){try{let l=await P.post("/api/option/rest_model_ratio");l.data.success?(X(l.data.message),u.refresh()):C(l.data.message)}catch(l){C(l)}}return t.useEffect(()=>{const l={};for(let F in u.options)Object.keys(s).includes(F)&&(l[F]=u.options[F]);r(l),y(structuredClone(l)),a.current.setValues(l)},[u.options]),e.jsxs(Ae,{spinning:n,children:[e.jsx(N,{values:s,getFormApi:l=>a.current=l,style:{marginBottom:15},children:e.jsxs(N.Section,{text:"倍率设置",children:[e.jsx(Ee,{gutter:16,children:e.jsx(he,{span:16,children:e.jsx(N.TextArea,{label:"模型固定价格",extraText:"一次调用消耗多少刀，优先级大于模型倍率",placeholder:'为一个 JSON 文本，键为模型名称，值为一次调用消耗多少刀，比如 "gpt-4-gizmo-*": 0.1，一次消耗0.1刀',field:"ModelPrice",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(l,F)=>lu(F),message:"不是合法的 JSON 字符串"}],onChange:l=>r({...s,ModelPrice:l})})})}),e.jsx(Ee,{gutter:16,children:e.jsx(he,{span:16,children:e.jsx(N.TextArea,{label:"模型倍率",extraText:"",placeholder:"为一个 JSON 文本，键为模型名称，值为倍率",field:"ModelRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(l,F)=>lu(F),message:"不是合法的 JSON 字符串"}],onChange:l=>r({...s,ModelRatio:l})})})}),e.jsx(Ee,{gutter:16,children:e.jsx(he,{span:16,children:e.jsx(N.TextArea,{label:"模型补全倍率（仅对自定义模型有效）",extraText:"仅对自定义模型有效",placeholder:"为一个 JSON 文本，键为模型名称，值为倍率",field:"CompletionRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(l,F)=>lu(F),message:"不是合法的 JSON 字符串"}],onChange:l=>r({...s,CompletionRatio:l})})})}),e.jsx(Ee,{gutter:16,children:e.jsx(he,{span:16,children:e.jsx(N.TextArea,{label:"分组倍率",extraText:"",placeholder:"为一个 JSON 文本，键为分组名称，值为倍率",field:"GroupRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",stopValidateWithError:!0,rules:[{validator:(l,F)=>lu(F),message:"不是合法的 JSON 字符串"}],onChange:l=>r({...s,GroupRatio:l})})})})]})}),e.jsxs(de,{children:[e.jsx(T,{onClick:w,children:"保存倍率设置"}),e.jsx(ve,{title:"确定重置模型倍率吗？",content:"此修改将不可逆",okType:"danger",position:"top",onConfirm:()=>{d()},children:e.jsx(T,{type:"danger",children:"重置模型倍率"})})]})]})}const Hn=()=>{let[u,n]=t.useState({QuotaForNewUser:0,QuotaForInviter:0,QuotaForInvitee:0,QuotaRemindThreshold:0,PreConsumedQuota:0,StreamCacheQueueLength:0,ModelRatio:"",CompletionRatio:"",ModelPrice:"",GroupRatio:"",TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:0,AutomaticDisableChannelEnabled:!1,AutomaticEnableChannelEnabled:!1,ChannelDisableThreshold:0,LogConsumeEnabled:!1,DisplayInCurrencyEnabled:!1,DisplayTokenStatEnabled:!1,CheckSensitiveEnabled:!1,CheckSensitiveOnPromptEnabled:!1,CheckSensitiveOnCompletionEnabled:"",StopOnSensitiveEnabled:"",SensitiveWords:"",MjNotifyEnabled:!1,MjAccountFilterEnabled:!1,MjModeClearEnabled:!1,MjForwardUrlEnabled:!1,DrawingEnabled:!1,DataExportEnabled:!1,DataExportDefaultTime:"hour",DataExportInterval:5,DefaultCollapseSidebar:!1,RetryTimes:0}),[i,s]=t.useState(!1);const r=async()=>{const h=await P.get("/api/option/"),{success:y,message:w,data:d}=h.data;if(y){let l={};d.forEach(F=>{(F.key==="ModelRatio"||F.key==="GroupRatio"||F.key==="CompletionRatio"||F.key==="ModelPrice")&&(F.value=JSON.stringify(JSON.parse(F.value),null,2)),F.key.endsWith("Enabled")||["DefaultCollapseSidebar"].includes(F.key)?l[F.key]=F.value==="true":l[F.key]=F.value}),n(l)}else C(w)};async function a(){try{s(!0),await r(),X("刷新成功")}catch{C("刷新失败")}finally{s(!1)}}return t.useEffect(()=>{a()},[]),e.jsx(e.Fragment,{children:e.jsxs(Ae,{spinning:i,size:"large",children:[e.jsx(we,{style:{marginTop:"10px"},children:e.jsx($n,{options:u,refresh:a})}),e.jsx(we,{style:{marginTop:"10px"},children:e.jsx(Rn,{options:u,refresh:a})}),e.jsx(we,{style:{marginTop:"10px"},children:e.jsx(On,{options:u,refresh:a})}),e.jsx(we,{style:{marginTop:"10px"},children:e.jsx(Nn,{options:u,refresh:a})}),e.jsx(we,{style:{marginTop:"10px"},children:e.jsx(Wn,{options:u,refresh:a})}),e.jsx(we,{style:{marginTop:"10px"},children:e.jsx(Un,{options:u,refresh:a})}),e.jsx(we,{style:{marginTop:"10px"},children:e.jsx(Kn,{options:u,refresh:a})}),e.jsx(we,{style:{marginTop:"10px"},children:e.jsx(Gn,{options:u,refresh:a})})]})})},qn=()=>{const u=Re(),n=bt(),[i,s]=t.useState("1");let r=[{tab:"个人设置",content:e.jsx(Mn,{}),itemKey:"personal"}];ct()&&(r.push({tab:"运营设置",content:e.jsx(Hn,{}),itemKey:"operation"}),r.push({tab:"系统设置",content:e.jsx(In,{}),itemKey:"system"}),r.push({tab:"其他设置",content:e.jsx(Pn,{}),itemKey:"other"}));const a=h=>{s(h),u(`?tab=${h}`)};return t.useEffect(()=>{const y=new URLSearchParams(window.location.search).get("tab");y?s(y):a("personal")},[n.search]),e.jsx("div",{children:e.jsx(ce,{children:e.jsx(ce.Content,{children:e.jsx(Tt,{type:"line",activeKey:i,onChange:h=>a(h),children:r.map(h=>e.jsx(It,{itemKey:h.itemKey,tab:h.tab,children:i===h.itemKey&&h.content},h.itemKey))})})})})},Vn=()=>{const[u,n]=t.useState({email:""}),{email:i}=u,[s,r]=t.useState(!1),[a,h]=t.useState(!1),[y,w]=t.useState(""),[d,l]=t.useState(""),[F,x]=t.useState(!1),[_,M]=t.useState(30);t.useEffect(()=>{let S=null;return F&&_>0?S=setInterval(()=>{M(_-1)},1e3):_===0&&(x(!1),M(30)),()=>clearInterval(S)},[F,_]);function I(S){const{name:q,value:H}=S.target;n(te=>({...te,[q]:H}))}async function $(S){if(x(!0),!i)return;if(a&&d===""){Se("请稍后几秒重试，Turnstile 正在检查用户环境！");return}r(!0);const q=await P.get(`/api/reset_password?email=${i}&turnstile=${d}`),{success:H,message:te}=q.data;H?(X("重置邮件发送成功，请检查邮箱！"),n({...u,email:""})):C(te),r(!1)}return e.jsx(Qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(Qe.Column,{style:{maxWidth:450},children:[e.jsxs(De,{as:"h2",color:"",textAlign:"center",children:[e.jsx(Lu,{src:"/logo.png"})," 密码重置"]}),e.jsx(G,{size:"large",children:e.jsxs(bu,{children:[e.jsx(G.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:i,onChange:I}),a?e.jsx(ou,{sitekey:y,onVerify:S=>{l(S)}}):e.jsx(e.Fragment,{}),e.jsx(uu,{color:"green",fluid:!0,size:"large",onClick:$,loading:s,disabled:F,children:F?`重试 (${_})`:"提交"})]})})]})})},Qn=()=>{const[u,n]=Ou(),[i,s]=t.useContext(Ze),[r,a]=t.useState("处理中...");t.useState(!0);let h=Re();const y=async(w,d,l)=>{const F=await P.get(`/api/oauth/github?code=${w}&state=${d}`),{success:x,message:_,data:M}=F.data;if(x)_==="bind"?(X("绑定成功！"),h("/setting")):(s({type:"login",payload:M}),localStorage.setItem("user",JSON.stringify(M)),X("登录成功！"),h("/"));else{C(_);{a("操作失败，重定向至登录界面中..."),h("/setting");return}}};return t.useEffect(()=>{let w=u.get("code"),d=u.get("state");y(w,d).then()},[]),e.jsx(bu,{style:{minHeight:"300px"},children:e.jsx(Yt,{active:!0,inverted:!0,children:e.jsx(Zt,{size:"large",children:r})})})},Jn=()=>{const[u,n]=t.useState({email:"",token:""}),{email:i,token:s}=u,[r,a]=t.useState(!1),[h,y]=t.useState(!1),[w,d]=t.useState(30),[l,F]=t.useState(""),[x,_]=Ou();t.useEffect(()=>{let I=x.get("token"),$=x.get("email");n({token:I,email:$})},[]),t.useEffect(()=>{let I=null;return h&&w>0?I=setInterval(()=>{d(w-1)},1e3):w===0&&(y(!1),d(30)),()=>clearInterval(I)},[h,w]);async function M(I){if(y(!0),!i)return;a(!0);const $=await P.post("/api/user/reset",{email:i,token:s}),{success:S,message:q}=$.data;if(S){let H=$.data.data;F(H),await ze(H),Gu(`新密码已复制到剪贴板：${H}`)}else C(q);a(!1)}return e.jsx(Qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(Qe.Column,{style:{maxWidth:450},children:[e.jsxs(De,{as:"h2",color:"",textAlign:"center",children:[e.jsx(Lu,{src:"/logo.png"})," 密码重置确认"]}),e.jsx(G,{size:"large",children:e.jsxs(bu,{children:[e.jsx(G.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:i,readOnly:!0}),l&&e.jsx(G.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"新密码",name:"newPassword",value:l,readOnly:!0,onClick:I=>{I.target.select(),navigator.clipboard.writeText(l),Gu(`密码已复制到剪贴板：${l}`)}}),e.jsx(uu,{color:"green",fluid:!0,size:"large",onClick:M,loading:r,disabled:h,children:h?"密码重置完成":"提交"})]})})]})})},Vu={"gpt-3.5-turbo-0301":"gpt-3.5-turbo","gpt-4-0314":"gpt-4","gpt-4-32k-0314":"gpt-4-32k"},Qu={400:"500"},Yn="1. 新建渠道时，请求通过当前浏览器发出；2. 编辑已有渠道，请求通过后端服务器发出";function Zn(u){switch(u){case 15:return"按照如下格式输入：APIKey|SecretKey";case 18:return"按照如下格式输入：APPID|APISecret|APIKey";case 22:return"按照如下格式输入：APIKey-AppId，例如：fastgpt-0sp2gtvfdgyi4k30jwlgwf1i-64f335d84283f05518e9e041";case 23:return"按照如下格式输入：AppId|SecretId|SecretKey";case 33:return"按照如下格式输入：Ak|Sk|Region";default:return"请输入渠道对应的鉴权密钥"}}const Ru=u=>{Re();const n=u.editingChannel.id,i=n!==void 0,[s,r]=t.useState(i),a=()=>{u.handleClose()},h={name:"",type:1,key:"",openai_organization:"",max_input_tokens:0,base_url:"",other:"",model_mapping:"",status_code_mapping:"",models:[],auto_ban:1,is_image:!1,max_input_tokens:0,is_support_stream:!1,is_support_system_prompt:!1,is_support_n_or_logprobs:!1,is_support_function_call:!1,test_model:"",groups:["default"]},[y,w]=t.useState(!1),[d,l]=t.useState(!1),[F,x]=t.useState(0),[_,M]=t.useState(!1),[I,$]=t.useState(!1),[S,q]=t.useState(!1),[H,te]=t.useState(!1),[Y,Z]=t.useState(!0),[L,ne]=t.useState(h),[re,b]=t.useState([]),[p,g]=t.useState([]),[R,E]=t.useState([]),[B,c]=t.useState([]),[f,v]=t.useState([]),[U,o]=t.useState(""),m=(A,J)=>{if(ne(V=>({...V,[A]:J})),A==="type"){let V=[];switch(J){case 2:V=["mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_uploads"];break;case 5:V=["swap_face","mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_zoom","mj_shorten","mj_modal","mj_inpaint","mj_custom_zoom","mj_high_variation","mj_low_variation","mj_pan","mj_uploads"];break;default:V=ku(J);break}L.models.length===0&&ne(se=>({...se,models:V})),c(V)}},D=async()=>{r(!0);let A=await P.get(`/api/channel/${n}`);if(A===void 0)return;const{success:J,message:V,data:se}=A.data;J?(se.models===""?se.models=[]:se.models=se.models.split(","),se.group===""?se.groups=[]:se.groups=se.group.split(","),se.model_mapping!==""&&(se.model_mapping=JSON.stringify(JSON.parse(se.model_mapping),null,2)),ne(se),se.auto_ban===0?Z(!1):Z(!0),se.is_image==!1?l(!1):l(!0),se.max_input_tokens&&x(se.max_input_tokens),se.is_support_stream&&M(se.is_support_stream),se.is_support_system_prompt&&$(se.is_support_system_prompt),se.is_support_n_or_logprobs&&q(se.is_support_n_or_logprobs),se.is_support_function_call&&te(se.is_support_function_call),c(ku(se.type))):C(V),r(!1)},W=async A=>{var se,me;if(L.type!==1){C("仅支持 OpenAI 接口格式");return}r(!0);const J=L.models||[];let V=!1;if(i){const be=await P.get("/api/channel/fetch_models/"+n);be.data&&((se=be.data)!=null&&se.success)?J.push(...be.data.data):V=!0}else if(!(L!=null&&L.key))C("请填写密钥"),V=!0;else try{const Te=`https://${new URL(L.base_url||"https://api.openai.com").hostname}/v1/models`,Ke=L.key,su=await rt.get(Te,{headers:{Authorization:`Bearer ${Ke}`}});su.data&&((me=su.data)!=null&&me.success)?J.push(...es.data.data.map(au=>au.id)):V=!0}catch{V=!0}V?C("获取模型列表失败"):(m(A,Array.from(new Set(J))),X("获取模型列表成功")),r(!1)},ee=async()=>{try{let A=await P.get("/api/channel/models"),J=A.data.data.map(V=>({label:V.id,value:V.id}));b(J),v(A.data.data.map(V=>V.id)),c(A.data.data.filter(V=>V.id.startsWith("gpt-3")||V.id.startsWith("text-")).map(V=>V.id))}catch(A){C(A.message)}},j=async()=>{try{let A=await P.get("/api/group/");if(A===void 0)return;E(A.data.data.map(J=>({label:J,value:J})))}catch(A){C(A.message)}};t.useEffect(()=>{let A=[...re];L.models.forEach(J=>{A.find(V=>V.key===J)||A.push({label:J,value:J})}),g(A)},[re,L.models]),t.useEffect(()=>{if(ee().then(),j().then(),i)D().then(()=>{});else{ne(h);let A=ku(L.type);c(A),ne(J=>({...J,models:A}))}},[u.editingChannel.id]);const K=async()=>{if(!i&&(L.name===""||L.key==="")){Se("请填写渠道名称和渠道密钥！");return}if(L.models.length===0){Se("请至少选择一个模型！");return}if(L.model_mapping!==""&&!lu(L.model_mapping)){Se("模型映射必须是合法的 JSON 格式！");return}let A={...L};A.base_url&&A.base_url.endsWith("/")&&(A.base_url=A.base_url.slice(0,A.base_url.length-1)),A.type===3&&A.other===""&&(A.other="2023-06-01-preview"),A.type===18&&A.other===""&&(A.other="v2.1");let J;if(!Array.isArray(A.models)){C("提交失败，请勿重复提交！"),a();return}A.auto_ban=Y?1:0,A.is_image=!!d,A.max_input_tokens=F,A.is_support_stream=_,A.is_support_system_prompt=I,A.is_support_n_or_logprobs=S,A.is_support_function_call=H,A.models=A.models.join(","),A.group=A.groups.join(","),i?J=await P.put("/api/channel/",{...A,id:parseInt(n)}):J=await P.post("/api/channel/",A);const{success:V,message:se}=J.data;V?(i?X("渠道更新成功！"):(X("渠道创建成功！"),ne(h)),u.refresh(),u.handleClose()):C(se)},ae=()=>{if(U.trim()==="")return;const A=U.split(",").map(me=>me.trim());let J=[...L.models],V=[...p],se=!1;A.forEach(me=>{me&&!J.includes(me)?(J.push(me),V.push({key:me,text:me,value:me})):me&&(C("某些模型已存在！"),se=!0)}),!se&&(g(V),o(""),m("models",J))};return e.jsx(e.Fragment,{children:e.jsx(mu,{maskClosable:!1,placement:i?"right":"left",title:e.jsx(tu,{level:3,children:i?"更新渠道信息":"创建新的渠道"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:K,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:a,children:"取消"})]})}),closeIcon:null,onCancel:()=>a(),width:ke()?"100%":600,children:e.jsxs(Ae,{spinning:s,children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"类型："})}),e.jsx(Me,{name:"type",required:!0,optionList:yu,value:L.type,onChange:A=>m("type",A),style:{width:"50%"}}),L.type===3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Ue,{type:"warning",description:e.jsxs(e.Fragment,{children:["注意，",e.jsx("strong",{children:"模型部署名称必须和模型名称保持一致"}),"，因为 One API 会把请求体中的 model 参数替换为你的部署名称（模型名称中的点会被剔除），",e.jsx("a",{target:"_blank",href:"https://github.com/songquanpeng/one-api/issues/133?notification_referrer_id=NT_kwDOAmJSYrM2NjIwMzI3NDgyOjM5OTk4MDUw#issuecomment-1571602271",children:"图片演示"}),"。"]})})}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"AZURE_OPENAI_ENDPOINT："})}),e.jsx(le,{label:"AZURE_OPENAI_ENDPOINT",name:"azure_base_url",placeholder:"请输入 AZURE_OPENAI_ENDPOINT，例如：https://docs-test-001.openai.azure.com",onChange:A=>{m("base_url",A)},value:L.base_url,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"默认 API 版本："})}),e.jsx(le,{label:"默认 API 版本",name:"azure_other",placeholder:"请输入默认 API 版本，例如：2023-06-01-preview，该配置可以被实际的请求查询参数所覆盖",onChange:A=>{m("other",A)},value:L.other,autoComplete:"new-password"})]}),L.type===8&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Ue,{type:"warning",description:e.jsx(e.Fragment,{children:"如果你对接的是上游One API或者New API等转发项目，请使用OpenAI类型，不要使用此类型，除非你知道你在做什么。"})})}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(ue.Text,{strong:!0,children:["完整的 Base URL，支持变量","{model}","："]})}),e.jsx(le,{name:"base_url",placeholder:"请输入完整的URL，例如：https://api.openai.com/v1/chat/completions",onChange:A=>{m("base_url",A)},value:L.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"名称："})}),e.jsx(le,{required:!0,name:"name",placeholder:"请为渠道命名",onChange:A=>{m("name",A)},value:L.name,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"分组："})}),e.jsx(Me,{placeholder:"请选择可以使用该渠道的分组",name:"groups",required:!0,multiple:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:A=>{m("groups",A)},value:L.groups,autoComplete:"new-password",optionList:R}),L.type===18&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"模型版本："})}),e.jsx(le,{name:"other",placeholder:"请输入星火大模型版本，注意是接口地址中的版本号，例如：v2.1",onChange:A=>{m("other",A)},value:L.other,autoComplete:"new-password"})]}),L.type===21&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"知识库 ID："})}),e.jsx(le,{label:"知识库 ID",name:"other",placeholder:"请输入知识库 ID，例如：123456",onChange:A=>{m("other",A)},value:L.other,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"模型："})}),e.jsx(Me,{placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:A=>{m("models",A)},value:L.models,autoComplete:"new-password",optionList:p}),e.jsxs("div",{style:{lineHeight:"40px",marginBottom:"12px"},children:[e.jsxs(de,{children:[e.jsx(T,{type:"primary",onClick:()=>{m("models",B)},children:"填入相关模型"}),e.jsx(T,{type:"secondary",onClick:()=>{m("models",f)},children:"填入所有模型"}),e.jsx($e,{content:Yn,children:e.jsx(T,{type:"tertiary",onClick:()=>{W("models")},children:"获取模型列表"})}),e.jsx(T,{type:"warning",onClick:()=>{m("models",[])},children:"清除所有模型"})]}),e.jsx(le,{addonAfter:e.jsx(T,{type:"primary",onClick:ae,children:"填入"}),placeholder:"输入自定义模型名称",value:U,onChange:A=>{o(A.trim())}})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"模型重定向："})}),e.jsx(_u,{placeholder:`此项可选，用于修改请求体中的模型名称，为一个 JSON 字符串，键为请求中模型名称，值为要替换的模型名称，例如：
${JSON.stringify(Vu,null,2)}`,name:"model_mapping",onChange:A=>{m("model_mapping",A)},autosize:!0,value:L.model_mapping,autoComplete:"new-password"}),e.jsx(ue.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{m("model_mapping",JSON.stringify(Vu,null,2))},children:"填入模板"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"密钥："})}),y?e.jsx(_u,{label:"密钥",name:"key",required:!0,placeholder:"请输入密钥，一行一个",onChange:A=>{m("key",A)},value:L.key,style:{minHeight:150,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password"}):e.jsx(le,{label:"密钥",name:"key",required:!0,placeholder:Zn(L.type),onChange:A=>{m("key",A)},value:L.key,autoComplete:"new-password"}),L.type===1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"组织："})}),e.jsx(le,{label:"组织，可选，不填则为默认组织",name:"openai_organization",placeholder:"请输入组织org-xxx",onChange:A=>{m("openai_organization",A)},value:L.openai_organization})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"默认测试模型："})}),e.jsx(le,{name:"test_model",placeholder:"不填则为模型列表第一个",onChange:A=>{m("test_model",A)},value:L.test_model}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(He,{name:"auto_ban",checked:Y,onChange:()=>{Z(!Y)}}),e.jsx(ue.Text,{strong:!0,children:"是否自动禁用（仅当自动禁用开启时有效），关闭后不会自动禁用该渠道："})]})}),!i&&e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(He,{checked:y,label:"批量创建",name:"batch",onChange:()=>w(!y)}),e.jsx(ue.Text,{strong:!0,children:"批量创建"})]})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(He,{checked:d,label:"is_image",name:"is_image",onChange:()=>l(!d)}),e.jsx(ue.Text,{strong:!0,children:"is_image"})]})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(le,{label:"最大请求token",name:"max_input_tokens",placeholder:"默认为0，表示不限制",onChange:A=>{x(A)},value:F}),e.jsx(ue.Text,{strong:!0,children:"最大请求token（0表示不限制）："})]})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(He,{checked:_,label:"is_support_stream",name:"is_support_stream",onChange:()=>M(!_)}),e.jsx(ue.Text,{strong:!0,children:"is_support_stream"})]})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(He,{checked:I,label:"is_support_system_prompt",name:"is_support_system_prompt",onChange:()=>$(!I)}),e.jsx(ue.Text,{strong:!0,children:"is_support_system_prompt"})]})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(He,{checked:S,label:"is_support_n_or_logprobs",name:"is_support_n_or_logprobs",onChange:()=>q(!S)}),e.jsx(ue.Text,{strong:!0,children:"is_support_n_or_logprobs"})]})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(He,{checked:H,label:"is_support_function_call",name:"is_support_function_call",onChange:()=>te(!H)}),e.jsx(ue.Text,{strong:!0,children:"is_support_function_call"})]})}),L.type!==3&&L.type!==8&&L.type!==22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"代理："})}),e.jsx(le,{label:"代理",name:"base_url",placeholder:"此项可选，用于通过代理站来进行 API 调用",onChange:A=>{m("base_url",A)},value:L.base_url,autoComplete:"new-password"})]}),L.type===22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"私有部署地址："})}),e.jsx(le,{name:"base_url",placeholder:"请输入私有部署地址，格式为：https://fastgpt.run/api/openapi",onChange:A=>{m("base_url",A)},value:L.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ue.Text,{strong:!0,children:"状态码复写（仅影响本地判断，不修改返回到上游的状态码）："})}),e.jsx(_u,{placeholder:`此项可选，用于复写返回的状态码，比如将claude渠道的400错误复写为500（用于重试），请勿滥用该功能，例如：
${JSON.stringify(Qu,null,2)}`,name:"status_code_mapping",onChange:A=>{m("status_code_mapping",A)},autosize:!0,value:L.status_code_mapping,autoComplete:"new-password"}),e.jsx(ue.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{m("status_code_mapping",JSON.stringify(Qu,null,2))},children:"填入模板"})]})})})};let ru;function Xn(u){var n,i;if(!ru){ru=new Map;for(let s=0;s<yu.length;s++)ru[yu[s].value]=yu[s];ru[0]={value:0,text:"未知类型",color:"grey"}}return e.jsx(z,{size:"large",color:(n=ru[u])==null?void 0:n.color,children:(i=ru[u])==null?void 0:i.text})}const us=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"分组",dataIndex:"group",render:(k,O,ie)=>e.jsx("div",{children:e.jsx(de,{spacing:2,children:k.split(",").map((oe,pe)=>ht(oe))})})},{title:"类型",dataIndex:"type",render:(k,O,ie)=>e.jsx("div",{children:Xn(k)})},{title:"状态",dataIndex:"status",render:(k,O,ie)=>e.jsx("div",{children:W(k)})},{title:"响应时间",dataIndex:"response_time",render:(k,O,ie)=>e.jsx("div",{children:ee(k)})},{title:"已用/剩余",dataIndex:"expired_time",render:(k,O,ie)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx($e,{content:"已用额度",children:e.jsx(z,{color:"white",type:"ghost",size:"large",children:xe(O.used_quota)})}),e.jsx($e,{content:"剩余额度"+O.balance+"，点击更新",children:e.jsxs(z,{color:"white",type:"ghost",size:"large",onClick:()=>{J(O)},children:["$",Fn(O.balance)]})})]})})},{title:"优先级",dataIndex:"priority",render:(k,O,ie)=>e.jsx("div",{children:e.jsx(Tu,{style:{width:70},name:"priority",onBlur:oe=>{D(O.id,"priority",O,oe.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:O.priority,min:-999})})},{title:"权重",dataIndex:"weight",render:(k,O,ie)=>e.jsx("div",{children:e.jsx(Tu,{style:{width:70},name:"weight",onBlur:oe=>{D(O.id,"weight",O,oe.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:O.weight,min:0})})},{title:"",dataIndex:"operate",render:(k,O,ie)=>e.jsxs("div",{children:[e.jsxs(et,{style:{marginRight:1},"aria-label":"测试操作项目组",children:[e.jsx(T,{theme:"light",onClick:()=>{K(O,"")},children:"测试"}),e.jsx(Ve,{trigger:"click",position:"bottomRight",menu:O.test_models,children:e.jsx(T,{style:{padding:"8px 4px"},type:"primary",icon:e.jsx(ut,{})})})]}),e.jsx(ve,{title:"确定是否要删除此渠道？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{D(O.id,"delete",O).then(()=>{f(O.id)})},children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),O.status===1?e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{D(O.id,"disable",O)},children:"禁用"}):e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{D(O.id,"enable",O)},children:"启用"}),e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{E(O),b(!0)},children:"编辑"}),e.jsx(ve,{title:"确定是否要复制此渠道？",content:"复制渠道的所有信息",okType:"danger",position:"left",onConfirm:async()=>{o(O.id)},children:e.jsx(T,{theme:"light",type:"primary",style:{marginRight:1},children:"复制"})})]})}],[n,i]=t.useState([]),[s,r]=t.useState(!0),[a,h]=t.useState(1),[y,w]=t.useState(!1),[d,l]=t.useState(""),[F,x]=t.useState(""),[_,M]=t.useState(""),[I,$]=t.useState(!1),[S,q]=t.useState(!1),[H,te]=t.useState(Fe);t.useState(hn("channel-test"));const[Y,Z]=t.useState(H),[L,ne]=t.useState([]),[re,b]=t.useState(!1),[p,g]=t.useState(!1),[R,E]=t.useState({id:void 0}),[B,c]=t.useState([]),f=k=>{let O=[...n];if(k!=null){let ie=O.findIndex(oe=>oe.id===k);ie>-1&&(O.splice(ie,1),i(O))}},v=k=>{for(let O=0;O<k.length;O++){k[O].key=""+k[O].id;let ie=[];k[O].models.split(",").forEach((oe,pe)=>{ie.push({node:"item",name:oe,onClick:()=>{K(k[O],oe)}})}),k[O].test_models=ie}i(k),k.length>=H?Z(k.length+H):Z(k.length)},U=async(k,O,ie)=>{r(!0);const oe=await P.get(`/api/channel/?p=${k}&page_size=${O}&id_sort=${ie}`);if(oe===void 0)return;const{success:pe,message:je,data:Oe}=oe.data;if(pe)if(k===0)v(Oe);else{let Xe=[...n];Xe.splice(k*O,Oe.length,...Oe),v(Xe)}else C(je);r(!1)},o=async k=>{const O=n.find(ie=>String(ie.id)===String(k));if(console.log(O),O.name+="_复制",O.created_time=null,O.balance=0,O.used_quota=0,!O){C("渠道未找到，请刷新页面后重试。");return}try{const ie={...O,id:void 0},oe=await P.post("/api/channel/",ie);oe.data.success?(X("渠道复制成功"),await m()):C(oe.data.message)}catch(ie){C("渠道复制失败: "+ie.message)}},m=async()=>{await U(a-1,H,y)};t.useEffect(()=>{const k=localStorage.getItem("id-sort")==="true",O=parseInt(localStorage.getItem("page-size"))||Fe;w(k),te(O),U(0,O,k).then().catch(ie=>{C(ie)}),su().then(),An().then()},[]);const D=async(k,O,ie,oe)=>{let pe={id:k},je;switch(O){case"delete":je=await P.delete(`/api/channel/${k}/`);break;case"enable":pe.status=1,je=await P.put("/api/channel/",pe);break;case"disable":pe.status=2,je=await P.put("/api/channel/",pe);break;case"priority":if(oe==="")return;pe.priority=parseInt(oe),je=await P.put("/api/channel/",pe);break;case"weight":if(oe==="")return;pe.weight=parseInt(oe),pe.weight<0&&(pe.weight=0),je=await P.put("/api/channel/",pe);break}const{success:Oe,message:Xe}=je.data;if(Oe){X("操作成功完成！");let Eu=je.data.data,Q=[...n];O==="delete"||(ie.status=Eu.status),i(Q)}else C(Xe)},W=k=>{switch(k){case 1:return e.jsx(z,{size:"large",color:"green",children:"已启用"});case 2:return e.jsx(z,{size:"large",color:"yellow",children:"已禁用"});case 3:return e.jsx(z,{size:"large",color:"yellow",children:"自动禁用"});default:return e.jsx(z,{size:"large",color:"grey",children:"未知状态"})}},ee=k=>{let O=k/1e3;return O=O.toFixed(2)+" 秒",k===0?e.jsx(z,{size:"large",color:"grey",children:"未测试"}):k<=1e3?e.jsx(z,{size:"large",color:"green",children:O}):k<=3e3?e.jsx(z,{size:"large",color:"lime",children:O}):k<=5e3?e.jsx(z,{size:"large",color:"yellow",children:O}):e.jsx(z,{size:"large",color:"red",children:O})},j=async(k,O,ie)=>{if(k===""&&O===""&&ie===""){await U(0,H,y),h(1);return}$(!0);const oe=await P.get(`/api/channel/search?keyword=${k}&group=${O}&model=${ie}`),{success:pe,message:je,data:Oe}=oe.data;pe?(i(Oe),h(1)):C(je),$(!1)},K=async(k,O)=>{const ie=await P.get(`/api/channel/test/${k.id}?model=${O}`),{success:oe,message:pe,time:je}=ie.data;oe?(k.response_time=je*1e3,k.test_time=Date.now()/1e3,Se(`通道 ${k.name} 测试成功，耗时 ${je.toFixed(2)} 秒。`)):C(pe)},ae=async()=>{const k=await P.get("/api/channel/test"),{success:O,message:ie}=k.data;O?Se("已成功开始测试所有通道，请刷新页面查看结果。"):C(ie)},A=async()=>{const k=await P.delete("/api/channel/disabled"),{success:O,message:ie,data:oe}=k.data;O?(X(`已删除所有禁用渠道，共计 ${oe} 个`),await m()):C(ie)},J=async k=>{const O=await P.get(`/api/channel/update_balance/${k.id}/`),{success:ie,message:oe,balance:pe}=O.data;ie?(k.balance=pe,k.balance_updated_time=Date.now()/1e3,Se(`通道 ${k.name} 余额更新成功！`)):C(oe)},V=async()=>{q(!0);const k=await P.get("/api/channel/update_balance"),{success:O,message:ie}=k.data;O?Se("已更新完毕所有已启用通道余额！"):C(ie),q(!1)},se=async()=>{if(B.length===0){C("请先选择要删除的通道！");return}r(!0);let k=[];B.forEach(je=>{k.push(je.id)});const O=await P.post("/api/channel/batch",{ids:k}),{success:ie,message:oe,data:pe}=O.data;ie?(X(`已删除 ${pe} 个通道！`),await m()):C(oe),r(!1)},me=async()=>{const k=await P.post("/api/channel/fix"),{success:O,message:ie,data:oe}=k.data;O?(X(`已修复 ${oe} 个通道！`),await m()):C(ie)};let be=n.slice((a-1)*H,a*H);const Te=k=>{h(k),k===Math.ceil(n.length/H)+1&&U(k-1,H,y).then(O=>{})},Ke=async k=>{localStorage.setItem("page-size",k+""),te(k),h(1),U(0,k,y).then().catch(O=>{C(O)})},su=async()=>{try{let k=await P.get("/api/group/");if(k===void 0)return;ne(k.data.data.map(O=>({label:O,value:O})))}catch(k){C(k.message)}},au=()=>{b(!1)},xu=(k,O)=>k.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(Ru,{refresh:m,visible:re,handleClose:au,editingChannel:R}),e.jsx(N,{onSubmit:()=>{j(d,F,_)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(de,{children:[e.jsx(N.Input,{field:"search_keyword",label:"搜索渠道关键词",placeholder:"ID，名称和密钥 ...",value:d,loading:I,onChange:k=>{l(k.trim())}}),e.jsx(N.Input,{field:"search_model",label:"模型",placeholder:"模型关键字",value:_,loading:I,onChange:k=>{M(k.trim())}}),e.jsx(N.Select,{field:"group",label:"分组",optionList:L,onChange:k=>{x(k),j(d,k,_)}}),e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsx(de,{children:e.jsxs(de,{children:[e.jsx(ue.Text,{strong:!0,children:"使用ID排序"}),e.jsx(Iu,{checked:y,label:"使用ID排序",uncheckedText:"关","aria-label":"是否用ID排序",onChange:k=>{localStorage.setItem("id-sort",k+""),w(k),U(0,H,k).then().catch(O=>{C(O)})}})]})})}),e.jsx(nu,{className:"channel-table",style:{marginTop:15},columns:u,dataSource:be,pagination:{currentPage:a,pageSize:H,total:Y,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,formatPageText:k=>"",onPageSizeChange:k=>{Ke(k).then()},onPageChange:Te},loading:s,onRow:xu,rowSelection:p?{onChange:(k,O)=>{c(O)}}:null}),e.jsx("div",{style:{display:ke()?"":"flex",marginTop:ke()?0:-45,zIndex:999,position:"relative",pointerEvents:"none"},children:e.jsxs(de,{style:{pointerEvents:"auto",marginTop:ke()?0:45},children:[e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{E({id:void 0}),b(!0)},children:"添加渠道"}),e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:ae,position:(ke(),"top"),children:e.jsx(T,{theme:"light",type:"warning",style:{marginRight:8},children:"测试所有通道"})}),e.jsx(ve,{title:"确定？",okType:"secondary",onConfirm:V,children:e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:8},children:"更新所有已启用通道余额"})}),e.jsx(ve,{title:"确定是否要删除禁用通道？",content:"此修改将不可逆",okType:"danger",onConfirm:A,children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:8},children:"删除禁用通道"})}),e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:m,children:"刷新"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(de,{children:[e.jsx(ue.Text,{strong:!0,children:"开启批量删除"}),e.jsx(Iu,{label:"开启批量删除",uncheckedText:"关","aria-label":"是否开启批量删除",onChange:k=>{g(k)}}),e.jsx(ve,{title:"确定是否要删除所选通道？",content:"此修改将不可逆",okType:"danger",onConfirm:se,disabled:!p,position:"top",children:e.jsx(T,{disabled:!p,theme:"light",type:"danger",style:{marginRight:8},children:"删除所选通道"})}),e.jsx(ve,{title:"确定是否要修复数据库一致性？",content:"进行该操作时，可能导致渠道访问错误，请仅在数据库出现问题时使用",okType:"warning",onConfirm:me,position:"top",children:e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:8},children:"修复数据库一致性"})})]})})]})},ts=()=>e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(ce.Header,{children:e.jsx("h3",{children:"管理渠道"})}),e.jsx(ce.Content,{children:e.jsx(us,{})})]})}),ns=u=>{const[n,i]=t.useState(!1),[s,r]=t.useState(n),a={name:"",remain_quota:n?0:5e5,expired_time:-1,unlimited_quota:!1,model_limits_enabled:!1,model_limits:[]},[h,y]=t.useState(a),{name:w,remain_quota:d,expired_time:l,unlimited_quota:F,model_limits_enabled:x,model_limits:_}=h,[M,I]=t.useState({});Re();const $=(p,g)=>{y(R=>({...R,[p]:g}))},S=()=>{u.handleClose()},q=(p,g,R,E)=>{let c=new Date().getTime()/1e3,f=p*30*24*60*60;f+=g*24*60*60,f+=R*60*60,f+=E*60,f!==0?(c+=f,y({...h,expired_time:Le(c)})):y({...h,expired_time:-1})},H=()=>{y({...h,unlimited_quota:!F})},te=async()=>{let p=await P.get("/api/user/models");const{success:g,message:R,data:E}=p.data;if(g){let B=E.map(c=>({label:c,value:c}));I(B)}else C(R)},Y=async()=>{r(!0);let p=await P.get(`/api/token/${u.editingToken.id}`);const{success:g,message:R,data:E}=p.data;g?(E.expired_time!==-1&&(E.expired_time=Le(E.expired_time)),E.model_limits!==""?E.model_limits=E.model_limits.split(","):E.model_limits=[],y(E)):C(R),r(!1)};t.useEffect(()=>{i(u.editingToken.id!==void 0)},[u.editingToken.id]),t.useEffect(()=>{n?Y().then(()=>{}):y(a),te()},[n]);const[Z,L]=t.useState(1),ne=p=>{const g=parseInt(p,10);!isNaN(g)&&g>0&&L(g)},re=()=>{const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let g="";for(let R=0;R<6;R++)g+=p.charAt(Math.floor(Math.random()*p.length));return g},b=async()=>{if(r(!0),n){let p={...h};if(p.remain_quota=parseInt(p.remain_quota),p.expired_time!==-1){let B=Date.parse(p.expired_time);if(isNaN(B)){C("过期时间格式错误！"),r(!1);return}p.expired_time=Math.ceil(B/1e3)}p.model_limits=p.model_limits.join(",");let g=await P.put("/api/token/",{...p,id:parseInt(u.editingToken.id)});const{success:R,message:E}=g.data;R?(X("令牌更新成功！"),u.refresh(),u.handleClose()):C(E)}else{let p=0;for(let g=0;g<Z;g++){let R={...h};if(g!==0&&(R.name=`${h.name}-${re()}`),R.remain_quota=parseInt(R.remain_quota),R.expired_time!==-1){let f=Date.parse(R.expired_time);if(isNaN(f)){C("过期时间格式错误！"),r(!1);break}R.expired_time=Math.ceil(f/1e3)}R.model_limits=R.model_limits.join(",");let E=await P.post("/api/token/",R);const{success:B,message:c}=E.data;if(B)p++;else{C(c);break}}p>0&&(X(`${p}个令牌创建成功，请在列表页面点击复制获取令牌！`),u.refresh(),u.handleClose())}r(!1),y(a),L(1)};return e.jsx(e.Fragment,{children:e.jsx(mu,{placement:n?"right":"left",title:e.jsx(tu,{level:3,children:n?"更新令牌信息":"创建新的令牌"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:b,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:S,children:"取消"})]})}),closeIcon:null,onCancel:()=>S(),width:ke()?"100%":600,children:e.jsxs(Ae,{spinning:s,children:[e.jsx(le,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:p=>$("name",p),value:w,autoComplete:"new-password",required:!n}),e.jsx(_e,{}),e.jsx(Pt,{label:"过期时间",name:"expired_time",placeholder:"请选择过期时间",onChange:p=>$("expired_time",p),value:l,autoComplete:"new-password",type:"dateTime"}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(de,{children:[e.jsx(T,{type:"tertiary",onClick:()=>{q(0,0,0,0)},children:"永不过期"}),e.jsx(T,{type:"tertiary",onClick:()=>{q(0,0,1,0)},children:"一小时"}),e.jsx(T,{type:"tertiary",onClick:()=>{q(1,0,0,0)},children:"一个月"}),e.jsx(T,{type:"tertiary",onClick:()=>{q(0,1,0,0)},children:"一天"})]})}),e.jsx(_e,{}),e.jsx(Ue,{type:"warning",description:"注意，令牌的额度仅用于限制令牌本身的最大额度使用量，实际的使用受到账户的剩余额度限制。"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:`额度${hu(d)}`})}),e.jsx(Pu,{style:{marginTop:8},name:"remain_quota",placeholder:"请输入额度",onChange:p=>$("remain_quota",p),value:d,autoComplete:"new-password",type:"number",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}],disabled:F}),!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:"新建数量"})}),e.jsx(Pu,{style:{marginTop:8},label:"数量",placeholder:"请选择或输入创建令牌的数量",onChange:p=>ne(p),onSelect:p=>ne(p),value:Z.toString(),autoComplete:"off",type:"number",data:[{value:10,label:"10个"},{value:20,label:"20个"},{value:30,label:"30个"},{value:100,label:"100个"}],disabled:F})]}),e.jsx("div",{children:e.jsx(T,{style:{marginTop:8},type:"warning",onClick:()=>{H()},children:F?"取消无限额度":"设为无限额度"})}),e.jsx(_e,{}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(He,{name:"model_limits_enabled",checked:x,onChange:p=>$("model_limits_enabled",p.target.checked)}),e.jsx(ue.Text,{children:"启用模型限制（非必要，不建议启用）"})]})}),e.jsx(Me,{style:{marginTop:8},placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:p=>{$("model_limits",p)},value:h.model_limits,autoComplete:"new-password",optionList:M,disabled:!x})]})})})};function Ju(u){return e.jsx(e.Fragment,{children:Le(u)})}function ss(u,n=!1){switch(u){case 1:return n?e.jsx(z,{color:"green",size:"large",children:"已启用：限制模型"}):e.jsx(z,{color:"green",size:"large",children:"已启用"});case 2:return e.jsxs(z,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(z,{color:"yellow",size:"large",children:[" ","已过期"," "]});case 4:return e.jsxs(z,{color:"grey",size:"large",children:[" ","已耗尽"," "]});default:return e.jsxs(z,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const as=()=>{const u=[{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(D,W,ee)=>e.jsx("div",{children:ss(D,W.model_limits_enabled)})},{title:"已用额度",dataIndex:"used_quota",render:(D,W,ee)=>e.jsx("div",{children:xe(parseInt(D))})},{title:"剩余额度",dataIndex:"remain_quota",render:(D,W,ee)=>e.jsx("div",{children:W.unlimited_quota?e.jsx(z,{size:"large",color:"white",children:"无限制"}):e.jsx(z,{size:"large",color:"light-blue",children:xe(parseInt(D))})})},{title:"创建时间",dataIndex:"created_time",render:(D,W,ee)=>e.jsx("div",{children:Ju(D)})},{title:"过期时间",dataIndex:"expired_time",render:(D,W,ee)=>e.jsx("div",{children:W.expired_time===-1?"永不过期":Ju(D)})},{title:"",dataIndex:"operate",render:(D,W,ee)=>e.jsxs("div",{children:[e.jsx(du,{content:"sk-"+W.key,style:{padding:20},position:"top",children:e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async j=>{await g("sk-"+W.key)},children:"复制"}),e.jsxs(et,{style:{marginRight:1},"aria-label":"项目操作按钮组",children:[e.jsx(T,{theme:"light",style:{color:"rgba(var(--semi-teal-7), 1)"},onClick:()=>{R("next",W.key)},children:"聊天"}),e.jsx(Ve,{trigger:"click",position:"bottomRight",menu:[{node:"item",key:"next",disabled:!localStorage.getItem("chat_link"),name:"ChatGPT Next Web",onClick:()=>{R("next",W.key)}},{node:"item",key:"next-mj",disabled:!localStorage.getItem("chat_link2"),name:"ChatGPT Web & Midjourney",onClick:()=>{R("next-mj",W.key)}},{node:"item",key:"ama",name:"AMA 问天（BotGem）",onClick:()=>{R("ama",W.key)}},{node:"item",key:"opencat",name:"OpenCat",onClick:()=>{R("opencat",W.key)}}],children:e.jsx(T,{style:{padding:"8px 4px",color:"rgba(var(--semi-teal-7), 1)"},type:"primary",icon:e.jsx(ut,{})})})]}),e.jsx(ve,{title:"确定是否要删除此令牌？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{B(W.id,"delete",W).then(()=>{E(W.key)})},children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),W.status===1?e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{B(W.id,"disable",W)},children:"禁用"}):e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{B(W.id,"enable",W)},children:"启用"}),e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{Z(W),r(!0)},children:"编辑"})]})}],[n,i]=t.useState(Fe),[s,r]=t.useState(!1),[a,h]=t.useState([]),[y,w]=t.useState([]),[d,l]=t.useState(n),[F,x]=t.useState(!0),[_,M]=t.useState(1),[I,$]=t.useState(""),[S,q]=t.useState(""),[H,te]=t.useState(!1);t.useState(!1),t.useState(0);const[Y,Z]=t.useState({id:void 0}),L=()=>{r(!1),setTimeout(()=>{Z({id:void 0})},500)},ne=D=>{h(D),D.length>=n?l(D.length+n):l(D.length)};let re=a.slice((_-1)*n,_*n);const b=async D=>{x(!0);const W=await P.get(`/api/token/?p=${D}&size=${n}`),{success:ee,message:j,data:K}=W.data;if(ee)if(D===0)ne(K);else{let ae=[...a];ae.splice(D*n,K.length,...K),ne(ae)}else C(j);x(!1)},p=async()=>{await b(_-1)},g=async D=>{await ze(D)?X("已复制到剪贴板！"):ye.error({title:"无法复制到剪贴板，请手动复制",content:D,size:"large"})},R=async(D,W)=>{let ee=localStorage.getItem("status"),j="";ee&&(ee=JSON.parse(ee),j=ee.server_address),j===""&&(j=window.location.origin);let K=encodeURIComponent(j);const ae=localStorage.getItem("chat_link"),A=localStorage.getItem("chat_link2");let J;ae&&(J=ae+`/#/?settings={"key":"sk-${W}","url":"${j}"}`);let V;switch(D){case"ama":V=`ama://set-api-key?server=${K}&key=sk-${W}`;break;case"opencat":V=`opencat://team/join?domain=${K}&token=sk-${W}`;break;case"next-mj":V=A+`/#/?settings={"key":"sk-${W}","url":"${j}"}`;break;default:if(!ae){C("管理员未设置聊天链接");return}V=J}window.open(V,"_blank")};t.useEffect(()=>{b(0).then().catch(D=>{C(D)})},[n]);const E=D=>{let W=[...a];if(D!=null){let ee=W.findIndex(j=>j.key===D);ee>-1&&(W.splice(ee,1),ne(W))}},B=async(D,W,ee)=>{x(!0);let j={id:D},K;switch(W){case"delete":K=await P.delete(`/api/token/${D}/`);break;case"enable":j.status=1,K=await P.put("/api/token/?status_only=true",j);break;case"disable":j.status=2,K=await P.put("/api/token/?status_only=true",j);break}const{success:ae,message:A}=K.data;if(ae){X("操作成功完成！");let J=K.data.data,V=[...a];W==="delete"||(ee.status=J.status),ne(V)}else C(A);x(!1)},c=async()=>{if(I===""&&S===""){await b(0),M(1);return}te(!0);const D=await P.get(`/api/token/search?keyword=${I}&token=${S}`),{success:W,message:ee,data:j}=D.data;W?(ne(j),M(1)):C(ee),te(!1)},f=async D=>{$(D.trim())},v=async D=>{q(D.trim())},U=D=>{M(D),D===Math.ceil(a.length/n)+1&&b(D-1).then(W=>{})},o={onSelect:(D,W)=>{},onSelectAll:(D,W)=>{},onChange:(D,W)=>{w(W)}},m=(D,W)=>D.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(ns,{refresh:p,editingToken:Y,visiable:s,handleClose:L}),e.jsxs(N,{layout:"horizontal",style:{marginTop:10},labelPosition:"left",children:[e.jsx(N.Input,{field:"keyword",label:"搜索关键字",placeholder:"令牌名称",value:I,loading:H,onChange:f}),e.jsx(N.Input,{field:"token",label:"Key",placeholder:"密钥",value:S,loading:H,onChange:v}),e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:c,style:{marginRight:8},children:"查询"})]}),e.jsx(nu,{style:{marginTop:20},columns:u,dataSource:re,pagination:{currentPage:_,pageSize:n,total:d,showSizeChanger:!0,pageSizeOptions:[10,20,50,100],formatPageText:D=>`第 ${D.currentStart} - ${D.currentEnd} 条，共 ${a.length} 条`,onPageSizeChange:D=>{i(D),M(1)},onPageChange:U},loading:F,rowSelection:o,onRow:m}),e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{Z({id:void 0}),r(!0)},children:"添加令牌"}),e.jsx(T,{label:"复制所选令牌",type:"warning",onClick:async()=>{if(y.length===0){C("请至少选择一个令牌！");return}let D="";for(let W=0;W<y.length;W++)D+=y[W].name+"    sk-"+y[W].key+`
`;await g(D)},children:"复制所选令牌到剪贴板"})]})},rs=()=>e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(ce.Header,{children:e.jsx("h3",{children:"我的令牌"})}),e.jsx(ce.Content,{children:e.jsx(as,{})})]})}),is=u=>{const n=u.editingRedemption.id!==void 0,[i,s]=t.useState(n);St(),Re();const r={name:"",quota:1e5,count:1},[a,h]=t.useState(r),{name:y,quota:w,count:d}=a,l=()=>{u.handleClose()},F=(M,I)=>{h($=>({...$,[M]:I}))},x=async()=>{s(!0);let M=await P.get(`/api/redemption/${u.editingRedemption.id}`);const{success:I,message:$,data:S}=M.data;I?h(S):C($),s(!1)};t.useEffect(()=>{n?x().then(()=>{}):h(r)},[u.editingRedemption.id]);const _=async()=>{if(!n&&a.name==="")return;s(!0);let M=a;M.count=parseInt(M.count),M.quota=parseInt(M.quota);let I;n?I=await P.put("/api/redemption/",{...M,id:parseInt(u.editingRedemption.id)}):I=await P.post("/api/redemption/",{...M});const{success:$,message:S,data:q}=I.data;if($?n?(X("兑换码更新成功！"),u.refresh(),u.handleClose()):(X("兑换码创建成功！"),h(r),u.refresh(),u.handleClose()):C(S),!n&&q){let H="";for(let te=0;te<q.length;te++)H+=q[te]+`
`;ye.confirm({title:"兑换码创建成功",content:e.jsxs("div",{children:[e.jsx("p",{children:"兑换码创建成功，是否下载兑换码？"}),e.jsx("p",{children:"兑换码将以文本文件的形式下载，文件名为兑换码的名称。"})]}),onOk:()=>{dn(H,`${a.name}.txt`)}})}s(!1)};return e.jsx(e.Fragment,{children:e.jsx(mu,{placement:n?"right":"left",title:e.jsx(tu,{level:3,children:n?"更新兑换码信息":"创建新的兑换码"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(T,{theme:"solid",size:"large",onClick:_,children:"提交"}),e.jsx(T,{theme:"solid",size:"large",type:"tertiary",onClick:l,children:"取消"})]})}),closeIcon:null,onCancel:()=>l(),width:ke()?"100%":600,children:e.jsxs(Ae,{spinning:i,children:[e.jsx(le,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:M=>F("name",M),value:y,autoComplete:"new-password",required:!n}),e.jsx(_e,{}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ue.Text,{children:`额度${hu(w)}`})}),e.jsx(Pu,{style:{marginTop:8},name:"quota",placeholder:"请输入额度",onChange:M=>F("quota",M),value:w,autoComplete:"new-password",type:"number",position:"bottom",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}]}),!n&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{}),e.jsx(ue.Text,{children:"生成数量"}),e.jsx(le,{style:{marginTop:8},label:"生成数量",name:"count",placeholder:"请输入生成数量",onChange:M=>F("count",M),value:d,autoComplete:"new-password",type:"number"})]})]})})})};function ls(u){return e.jsx(e.Fragment,{children:Le(u)})}function os(u){switch(u){case 1:return e.jsx(z,{color:"green",size:"large",children:"未使用"});case 2:return e.jsxs(z,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(z,{color:"grey",size:"large",children:[" ","已使用"," "]});default:return e.jsxs(z,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const cs=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(c,f,v)=>e.jsx("div",{children:os(c)})},{title:"额度",dataIndex:"quota",render:(c,f,v)=>e.jsx("div",{children:xe(parseInt(c))})},{title:"创建时间",dataIndex:"created_time",render:(c,f,v)=>e.jsx("div",{children:ls(c)})},{title:"兑换人ID",dataIndex:"used_user_id",render:(c,f,v)=>e.jsx("div",{children:c===0?"无":c})},{title:"",dataIndex:"operate",render:(c,f,v)=>e.jsxs("div",{children:[e.jsx(du,{content:f.key,style:{padding:20},position:"top",children:e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async U=>{await L(f.key)},children:"复制"}),e.jsx(ve,{title:"确定是否要删除此兑换码？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{re(f.id,"delete",f).then(()=>{Z(f.key)})},children:e.jsx(T,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),f.status===1?e.jsx(T,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{re(f.id,"disable",f)},children:"禁用"}):e.jsx(T,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{re(f.id,"enable",f)},disabled:f.status===3,children:"启用"}),e.jsx(T,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{$(f),q(!0)},disabled:f.status!==1,children:"编辑"})]})}],[n,i]=t.useState([]),[s,r]=t.useState(!0),[a,h]=t.useState(1),[y,w]=t.useState(""),[d,l]=t.useState(!1),[F,x]=t.useState(Fe),[_,M]=t.useState([]),[I,$]=t.useState({id:void 0}),[S,q]=t.useState(!1),H=()=>{q(!1)},te=c=>{i(c),c.length>=a*Fe?x(c.length+1):x(c.length)},Y=async c=>{const f=await P.get(`/api/redemption/?p=${c}`),{success:v,message:U,data:o}=f.data;if(v)if(c===0)te(o);else{let m=n;m.push(...o),te(m)}else C(U);r(!1)},Z=c=>{let f=[...n];if(c!=null){let v=f.findIndex(U=>U.key===c);v>-1&&(f.splice(v,1),i(f))}},L=async c=>{await ze(c)?X("已复制到剪贴板！"):ye.error({title:"无法复制到剪贴板，请手动复制",content:c})};t.useEffect(()=>{Y(0).then().catch(c=>{C(c)})},[]);const ne=async()=>{await Y(a-1)},re=async(c,f,v)=>{let U={id:c},o;switch(f){case"delete":o=await P.delete(`/api/redemption/${c}/`);break;case"enable":U.status=1,o=await P.put("/api/redemption/?status_only=true",U);break;case"disable":U.status=2,o=await P.put("/api/redemption/?status_only=true",U);break}const{success:m,message:D}=o.data;if(m){X("操作成功完成！");let W=o.data.data,ee=[...n];f==="delete"||(v.status=W.status),i(ee)}else C(D)},b=async()=>{if(y===""){await Y(0),h(1);return}l(!0);const c=await P.get(`/api/redemption/search?keyword=${y}`),{success:f,message:v,data:U}=c.data;f?(i(U),h(1)):C(v),l(!1)},p=async c=>{w(c.trim())},g=c=>{h(c),c===Math.ceil(n.length/Fe)+1&&Y(c-1).then(f=>{})};let R=n.slice((a-1)*Fe,a*Fe);const E={onSelect:(c,f)=>{},onSelectAll:(c,f)=>{},onChange:(c,f)=>{M(f)}},B=(c,f)=>c.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(is,{refresh:ne,editingRedemption:I,visiable:S,handleClose:H}),e.jsx(N,{onSubmit:b,children:e.jsx(N.Input,{label:"搜索关键字",field:"keyword",icon:"search",iconPosition:"left",placeholder:"关键字(id或者名称)",value:y,loading:d,onChange:p})}),e.jsx(nu,{style:{marginTop:20},columns:u,dataSource:R,pagination:{currentPage:a,pageSize:Fe,total:F,formatPageText:c=>`第 ${c.currentStart} - ${c.currentEnd} 条，共 ${n.length} 条`,onPageChange:g},loading:s,rowSelection:E,onRow:B}),e.jsx(T,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{$({id:void 0}),q(!0)},children:"添加兑换码"}),e.jsx(T,{label:"复制所选兑换码",type:"warning",onClick:async()=>{if(_.length===0){C("请至少选择一个兑换码！");return}let c="";for(let f=0;f<_.length;f++)c+=_[f].name+"    "+_[f].key+`
`;await L(c)},children:"复制所选兑换码到剪贴板"})]})},ds=()=>e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(ce.Header,{children:e.jsx("h3",{children:"管理兑换码"})}),e.jsx(ce.Content,{children:e.jsx(cs,{})})]})}),hs=()=>{const[u,n]=t.useState(""),[i,s]=t.useState(""),[r,a]=t.useState(0);t.useState(1);const[h,y]=t.useState(0),[w,d]=t.useState(1),[l,F]=t.useState(""),[x,_]=t.useState(!1),[M,I]=t.useState(0),[$,S]=t.useState(!1),[q,H]=t.useState(!1),[te,Y]=t.useState(""),Z=async()=>{if(u===""){Se("请输入兑换码！");return}S(!0);try{const E=await P.post("/api/user/topup",{key:u}),{success:B,message:c,data:f}=E.data;B?(X("兑换成功！"),ye.success({title:"兑换成功！",content:"成功兑换额度："+xe(f),centered:!0}),I(v=>v+f),n("")):C(c)}catch{C("请求失败")}finally{S(!1)}},L=()=>{if(!l){C("超级管理员未设置充值链接！");return}window.open(l,"_blank")},ne=async E=>{if(!x){C("管理员未开启在线充值！");return}if(await g(),r<w){C("充值数量不能小于"+w);return}Y(E),H(!0)},re=async()=>{if(h===0&&await g(),r<w){C("充值数量不能小于"+w);return}H(!1);try{const E=await P.post("/api/user/pay",{amount:parseInt(r),top_up_code:i,payment_method:te});if(E!==void 0){const{message:B,data:c}=E.data;if(B==="success"){let f=c,v=E.data.url,U=document.createElement("form");U.action=v,U.method="POST",navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1||(U.target="_blank");for(let m in f){let D=document.createElement("input");D.type="hidden",D.name=m,D.value=f[m],U.appendChild(D)}document.body.appendChild(U),U.submit(),document.body.removeChild(U)}else C(c)}else C(E)}catch(E){console.log(E)}finally{}},b=async()=>{let E=await P.get("/api/user/self");const{success:B,message:c,data:f}=E.data;B?I(f.quota):C(c)};t.useEffect(()=>{let E=localStorage.getItem("status");E&&(E=JSON.parse(E),E.top_up_link&&F(E.top_up_link),E.min_topup&&d(E.min_topup),E.enable_online_topup&&_(E.enable_online_topup)),b().then()},[]);const p=()=>h+"元",g=async E=>{E===void 0&&(E=r);try{const B=await P.post("/api/user/amount",{amount:parseFloat(E),top_up_code:i});if(B!==void 0){const{message:c,data:f}=B.data;c==="success"?y(parseFloat(f)):(y(0),Pe.error({content:"错误："+f,id:"getAmount"}))}else C(B)}catch(B){console.log(B)}finally{}},R=()=>{H(!1)};return e.jsx("div",{children:e.jsxs(ce,{children:[e.jsx(ce.Header,{children:e.jsx("h3",{children:"我的钱包"})}),e.jsxs(ce.Content,{children:[e.jsxs(ye,{title:"确定要充值吗",visible:q,onOk:re,onCancel:R,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("p",{children:["充值数量：",r]}),e.jsxs("p",{children:["实付金额：",p()]}),e.jsx("p",{children:"是否确认充值？"})]}),e.jsx("div",{style:{marginTop:20,display:"flex",justifyContent:"center"},children:e.jsxs(we,{style:{width:"500px",padding:"20px"},children:[e.jsxs(tu,{level:3,style:{textAlign:"center"},children:["余额 ",xe(M)]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Du,{children:"兑换余额"}),e.jsxs(N,{children:[e.jsx(N.Input,{field:"redemptionCode",label:"兑换码",placeholder:"兑换码",name:"redemptionCode",value:u,onChange:E=>{n(E)}}),e.jsxs(de,{children:[l?e.jsx(T,{type:"primary",theme:"solid",onClick:L,children:"获取兑换码"}):null,e.jsx(T,{type:"warning",theme:"solid",onClick:Z,disabled:$,children:$?"兑换中...":"兑换"})]})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Du,{children:"在线充值"}),e.jsxs(N,{children:[e.jsx(N.Input,{disabled:!x,field:"redemptionCount",label:"实付金额："+p(),placeholder:"充值数量，最低 "+mn(w),name:"redemptionCount",type:"number",value:r,onChange:async E=>{E<1&&(E=1),a(E),await g(E)}}),e.jsxs(de,{children:[e.jsx(T,{type:"primary",theme:"solid",onClick:async()=>{ne("zfb")},children:"支付宝"}),e.jsx(T,{style:{backgroundColor:"rgba(var(--semi-green-5), 1)"},type:"primary",theme:"solid",onClick:async()=>{ne("wx")},children:"微信"})]})]})]})]})})]})]})})},{Header:Fs}=ce,Yu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function ps(u){switch(u){case 1:return e.jsxs(z,{color:"cyan",size:"large",children:[" ","充值"," "]});case 2:return e.jsxs(z,{color:"lime",size:"large",children:[" ","消费"," "]});case 3:return e.jsxs(z,{color:"orange",size:"large",children:[" ","管理"," "]});case 4:return e.jsxs(z,{color:"purple",size:"large",children:[" ","系统"," "]});default:return e.jsxs(z,{color:"black",size:"large",children:[" ","未知"," "]})}}function ms(u){return u?e.jsx(z,{color:"blue",size:"large",children:"流"}):e.jsx(z,{color:"purple",size:"large",children:"非流"})}function gs(u){const n=parseInt(u);return n<101?e.jsxs(z,{color:"green",size:"large",children:[" ",n," s"," "]}):n<300?e.jsxs(z,{color:"orange",size:"large",children:[" ",n," s"," "]}):e.jsxs(z,{color:"red",size:"large",children:[" ",n," s"," "]})}const xs=()=>{const u=[{title:"时间",dataIndex:"timestamp2string"},{title:"渠道",dataIndex:"channel",className:Ie()?"tableShow":"tableHiddle",render:(j,K,ae)=>S?K.type===0||K.type===2?e.jsx("div",{children:e.jsxs(z,{color:Yu[parseInt(j)%Yu.length],size:"large",children:[" ",j," "]})}):e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{})},{title:"用户",dataIndex:"username",className:Ie()?"tableShow":"tableHiddle",render:(j,K,ae)=>S?e.jsxs("div",{children:[e.jsx(zu,{size:"small",color:Fu(j),style:{marginRight:4},onClick:()=>f(K.user_id),children:typeof j=="string"&&j.slice(0,1)}),j]}):e.jsx(e.Fragment,{})},{title:"令牌",dataIndex:"token_name",render:(j,K,ae)=>K.type===0||K.type===2?e.jsx("div",{children:e.jsxs(z,{color:"grey",size:"large",onClick:()=>{ee(j)},children:[" ",j," "]})}):e.jsx(e.Fragment,{})},{title:"类型",dataIndex:"type",render:(j,K,ae)=>e.jsx("div",{children:ps(j)})},{title:"模型",dataIndex:"model_name",render:(j,K,ae)=>K.type===0||K.type===2?e.jsx("div",{children:e.jsxs(z,{color:Fu(j),size:"large",onClick:()=>{ee(j)},children:[" ",j," "]})}):e.jsx(e.Fragment,{})},{title:"用时",dataIndex:"use_time",render:(j,K,ae)=>e.jsx("div",{children:e.jsxs(de,{children:[gs(j),ms(K.is_stream)]})})},{title:"提示",dataIndex:"prompt_tokens",render:(j,K,ae)=>K.type===0||K.type===2?e.jsx("div",{children:e.jsxs("span",{children:[" ",j," "]})}):e.jsx(e.Fragment,{})},{title:"补全",dataIndex:"completion_tokens",render:(j,K,ae)=>parseInt(j)>0&&(K.type===0||K.type===2)?e.jsx("div",{children:e.jsxs("span",{children:[" ",j," "]})}):e.jsx(e.Fragment,{})},{title:"花费",dataIndex:"quota",render:(j,K,ae)=>K.type===0||K.type===2?e.jsx("div",{children:xe(j,6)}):e.jsx(e.Fragment,{})},{title:"重试",dataIndex:"retry",className:Ie()?"tableShow":"tableHiddle",render:(j,K,ae)=>{let A="渠道："+K.channel;if(K.other!==""){let J=JSON.parse(K.other);if(J===null)return e.jsx(e.Fragment,{});J.admin_info!==void 0&&J.admin_info.use_channel!==null&&J.admin_info.use_channel!==void 0&&J.admin_info.use_channel!==""&&(A=`渠道：${J.admin_info.use_channel.join("->")}`)}return S?e.jsx("div",{children:A}):e.jsx(e.Fragment,{})}},{title:"详情",dataIndex:"content",render:(j,K,ae)=>{K.other===""&&(K.other="{}");let A=JSON.parse(K.other);if(A==null)return e.jsx(Wu,{ellipsis:{rows:2,showTooltip:{type:"popover",opts:{style:{width:240}}}},style:{maxWidth:240},children:j});let J=gn(K.prompt_tokens,K.completion_tokens,A.model_ratio,A.model_price,A.completion_ratio,A.group_ratio);return e.jsx($e,{content:J,children:e.jsx(Wu,{ellipsis:{rows:2},style:{maxWidth:240},children:j})})}}],[n,i]=t.useState([]),[s,r]=t.useState(!1),[a,h]=t.useState(!1),[y,w]=t.useState(!1),[d,l]=t.useState(1),[F,x]=t.useState(Fe),[_,M]=t.useState(Fe);t.useState(""),t.useState(!1);const[I,$]=t.useState(0),S=Ie();let q=new Date;const[H,te]=t.useState({username:"",token_name:"",model_name:"",start_timestamp:Le(q.getTime()/1e3-86400),end_timestamp:Le(q.getTime()/1e3+3600),channel:""}),{username:Y,token_name:Z,model_name:L,start_timestamp:ne,end_timestamp:re,channel:b}=H,[p,g]=t.useState({quota:0,token:0}),R=(j,K)=>{te(ae=>({...ae,[K]:j}))},E=async()=>{let j=Date.parse(ne)/1e3,K=Date.parse(re)/1e3,ae=await P.get(`/api/log/self/stat?type=${I}&token_name=${Z}&model_name=${L}&start_timestamp=${j}&end_timestamp=${K}`);const{success:A,message:J,data:V}=ae.data;A?g(V):C(J)},B=async()=>{let j=Date.parse(ne)/1e3,K=Date.parse(re)/1e3,ae=await P.get(`/api/log/stat?type=${I}&username=${Y}&token_name=${Z}&model_name=${L}&start_timestamp=${j}&end_timestamp=${K}&channel=${b}`);const{success:A,message:J,data:V}=ae.data;A?g(V):C(J)},c=async()=>{w(!0),S?await B():await E(),r(!0),w(!1)},f=async j=>{if(!S)return;const K=await P.get(`/api/user/${j}`),{success:ae,message:A,data:J}=K.data;ae?ye.info({title:"用户信息",content:e.jsxs("div",{style:{padding:12},children:[e.jsxs("p",{children:["用户名: ",J.username]}),e.jsxs("p",{children:["余额: ",xe(J.quota)]}),e.jsxs("p",{children:["已用额度：",xe(J.used_quota)]}),e.jsxs("p",{children:["请求次数：",Au(J.request_count)]})]}),centered:!0}):C(A)},v=j=>{for(let K=0;K<j.length;K++)j[K].timestamp2string=Le(j[K].created_at),j[K].key=""+j[K].id;i(j),x(j.length+Fe)},U=async(j,K,ae=0)=>{h(!0);let A="",J=Date.parse(ne)/1e3,V=Date.parse(re)/1e3;S?A=`/api/log/?p=${j}&page_size=${K}&type=${ae}&username=${Y}&token_name=${Z}&model_name=${L}&start_timestamp=${J}&end_timestamp=${V}&channel=${b}`:A=`/api/log/self/?p=${j}&page_size=${K}&type=${ae}&token_name=${Z}&model_name=${L}&start_timestamp=${J}&end_timestamp=${V}`;const se=await P.get(A),{success:me,message:be,data:Te}=se.data;if(me)if(j===0)v(Te);else{let Ke=[...n];Ke.splice(j*K,Te.length,...Te),v(Ke)}else C(be);h(!1)},o=n.slice((d-1)*_,d*_),m=j=>{l(j),j===Math.ceil(n.length/_)+1&&U(j-1,_,I).then(K=>{})},D=async j=>{localStorage.setItem("page-size",j+""),M(j),l(1),U(0,j).then().catch(K=>{C(K)})},W=async()=>{l(1),await U(0,_,I)},ee=async j=>{await ze(j)?X("已复制："+j):ye.error({title:"无法复制到剪贴板，请手动复制",content:j})};return t.useEffect(()=>{const j=parseInt(localStorage.getItem("page-size"))||Fe;M(j),U(0,j).then().catch(K=>{C(K)})},[]),e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(Fs,{children:e.jsx(Ae,{spinning:y,children:e.jsxs("h3",{children:["使用明细（总消耗额度：",e.jsx("span",{onClick:c,style:{cursor:"pointer",color:"gray"},children:s?xe(p.quota):"点击查看"}),"）"]})})}),e.jsx(N,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(N.Input,{field:"token_name",label:"令牌名称",style:{width:176},value:Z,placeholder:"可选值",name:"token_name",onChange:j=>R(j,"token_name")}),e.jsx(N.Input,{field:"model_name",label:"模型名称",style:{width:176},value:L,placeholder:"可选值",name:"model_name",onChange:j=>R(j,"model_name")}),e.jsx(N.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:ne,value:ne,type:"dateTime",name:"start_timestamp",onChange:j=>R(j,"start_timestamp")}),e.jsx(N.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:re,value:re,type:"dateTime",name:"end_timestamp",onChange:j=>R(j,"end_timestamp")}),S&&e.jsxs(e.Fragment,{children:[e.jsx(N.Input,{field:"channel",label:"渠道 ID",style:{width:176},value:b,placeholder:"可选值",name:"channel",onChange:j=>R(j,"channel")}),e.jsx(N.Input,{field:"username",label:"用户名称",style:{width:176},value:Y,placeholder:"可选值",name:"username",onChange:j=>R(j,"username")})]}),e.jsx(N.Section,{children:e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:W,loading:a,children:"查询"})})]})}),e.jsx(nu,{style:{marginTop:5},columns:u,dataSource:o,pagination:{currentPage:d,pageSize:_,total:F,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,onPageSizeChange:j=>{D(j).then()},onPageChange:m}}),e.jsxs(Me,{defaultValue:"0",style:{width:120},onChange:j=>{$(parseInt(j)),U(0,_,parseInt(j))},children:[e.jsx(Me.Option,{value:"0",children:"全部"}),e.jsx(Me.Option,{value:"1",children:"充值"}),e.jsx(Me.Option,{value:"2",children:"消费"}),e.jsx(Me.Option,{value:"3",children:"管理"}),e.jsx(Me.Option,{value:"4",children:"系统"})]})]})})},Es=()=>e.jsx(e.Fragment,{children:e.jsx(xs,{})}),Cs=()=>{const u=localStorage.getItem("chat_link");return e.jsx("iframe",{src:u,style:{width:"100%",height:"85vh",border:"none"}})},Zu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function fs(u){switch(u){case"IMAGINE":return e.jsx(z,{color:"blue",size:"large",children:"绘图"});case"UPSCALE":return e.jsx(z,{color:"orange",size:"large",children:"放大"});case"VARIATION":return e.jsx(z,{color:"purple",size:"large",children:"变换"});case"HIGH_VARIATION":return e.jsx(z,{color:"purple",size:"large",children:"强变换"});case"LOW_VARIATION":return e.jsx(z,{color:"purple",size:"large",children:"弱变换"});case"PAN":return e.jsx(z,{color:"cyan",size:"large",children:"平移"});case"DESCRIBE":return e.jsx(z,{color:"yellow",size:"large",children:"图生文"});case"BLEND":return e.jsx(z,{color:"lime",size:"large",children:"图混合"});case"SHORTEN":return e.jsx(z,{color:"pink",size:"large",children:"缩词"});case"REROLL":return e.jsx(z,{color:"indigo",size:"large",children:"重绘"});case"INPAINT":return e.jsx(z,{color:"violet",size:"large",children:"局部重绘-提交"});case"ZOOM":return e.jsx(z,{color:"teal",size:"large",children:"变焦"});case"CUSTOM_ZOOM":return e.jsx(z,{color:"teal",size:"large",children:"自定义变焦-提交"});case"MODAL":return e.jsx(z,{color:"green",size:"large",children:"窗口处理"});case"SWAP_FACE":return e.jsx(z,{color:"light-green",size:"large",children:"换脸"});default:return e.jsx(z,{color:"white",size:"large",children:"未知"})}}function js(u){switch(u){case 1:return e.jsx(z,{color:"green",size:"large",children:"已提交"});case 21:return e.jsx(z,{color:"lime",size:"large",children:"等待中"});case 22:return e.jsx(z,{color:"orange",size:"large",children:"重复提交"});case 0:return e.jsx(z,{color:"yellow",size:"large",children:"未提交"});default:return e.jsx(z,{color:"white",size:"large",children:"未知"})}}function ys(u){switch(u){case"SUCCESS":return e.jsx(z,{color:"green",size:"large",children:"成功"});case"NOT_START":return e.jsx(z,{color:"grey",size:"large",children:"未启动"});case"SUBMITTED":return e.jsx(z,{color:"yellow",size:"large",children:"队列中"});case"IN_PROGRESS":return e.jsx(z,{color:"blue",size:"large",children:"执行中"});case"FAILURE":return e.jsx(z,{color:"red",size:"large",children:"失败"});case"MODAL":return e.jsx(z,{color:"yellow",size:"large",children:"窗口等待"});default:return e.jsx(z,{color:"white",size:"large",children:"未知"})}}const Ds=u=>{const n=new Date(u*1e3),i=n.getFullYear(),s=("0"+(n.getMonth()+1)).slice(-2),r=("0"+n.getDate()).slice(-2),a=("0"+n.getHours()).slice(-2),h=("0"+n.getMinutes()).slice(-2),y=("0"+n.getSeconds()).slice(-2);return`${i}-${s}-${r} ${a}:${h}:${y}`};function Bs(u,n){if(!u||!n)return"N/A";const i=new Date(u),a=((new Date(n)-i)/1e3).toFixed(1),h=a>60?"red":"green";return e.jsxs(z,{color:h,size:"large",children:[a," 秒"]})}const As=()=>{const[u,n]=t.useState(!1),[i,s]=t.useState(""),r=[{title:"提交时间",dataIndex:"submit_time",render:(o,m,D)=>e.jsx("div",{children:Ds(o/1e3)})},{title:"花费时间",dataIndex:"finish_time",key:"finish_time",render:(o,m)=>Bs(m.submit_time,o)},{title:"渠道",dataIndex:"channel_id",className:Ie()?"tableShow":"tableHiddle",render:(o,m,D)=>e.jsx("div",{children:e.jsxs(z,{color:Zu[parseInt(o)%Zu.length],size:"large",onClick:()=>{U(o)},children:[" ",o," "]})})},{title:"类型",dataIndex:"action",render:(o,m,D)=>e.jsx("div",{children:fs(o)})},{title:"任务ID",dataIndex:"mj_id",render:(o,m,D)=>e.jsx("div",{children:o})},{title:"提交结果",dataIndex:"code",className:Ie()?"tableShow":"tableHiddle",render:(o,m,D)=>e.jsx("div",{children:js(o)})},{title:"任务状态",dataIndex:"status",className:Ie()?"tableShow":"tableHiddle",render:(o,m,D)=>e.jsx("div",{children:ys(o)})},{title:"进度",dataIndex:"progress",render:(o,m,D)=>e.jsx("div",{children:e.jsx(Mt,{stroke:m.status==="FAILURE"?"var(--semi-color-warning)":null,percent:o?parseInt(o.replace("%","")):0,showInfo:!0,"aria-label":"drawing progress"})})},{title:"结果图片",dataIndex:"image_url",render:(o,m,D)=>o?e.jsx(T,{onClick:()=>{Y(o),S(!0)},children:"查看图片"}):"无"},{title:"Prompt",dataIndex:"prompt",render:(o,m,D)=>o?e.jsx(ue.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(o),n(!0)},children:o}):"无"},{title:"PromptEn",dataIndex:"prompt_en",render:(o,m,D)=>o?e.jsx(ue.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(o),n(!0)},children:o}):"无"},{title:"失败原因",dataIndex:"fail_reason",render:(o,m,D)=>o?e.jsx(ue.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(o),n(!0)},children:o}):"无"}],[a,h]=t.useState([]),[y,w]=t.useState(!0),[d,l]=t.useState(1),[F,x]=t.useState(Fe),[_,M]=t.useState(0),I=Ie(),[$,S]=t.useState(!1),[q,H]=t.useState(!1),[te,Y]=t.useState("");let Z=new Date;const[L,ne]=t.useState({channel_id:"",mj_id:"",start_timestamp:Le(Z.getTime()/1e3-2592e3),end_timestamp:Le(Z.getTime()/1e3+3600)}),{channel_id:re,mj_id:b,start_timestamp:p,end_timestamp:g}=L;t.useState({quota:0,token:0});const R=(o,m)=>{ne(D=>({...D,[m]:o}))},E=o=>{for(let m=0;m<o.length;m++)o[m].timestamp2string=Le(o[m].created_at),o[m].key=""+o[m].id;h(o),x(o.length+Fe)},B=async o=>{w(!0);let m="",D=Date.parse(p),W=Date.parse(g);I?m=`/api/mj/?p=${o}&channel_id=${re}&mj_id=${b}&start_timestamp=${D}&end_timestamp=${W}`:m=`/api/mj/self/?p=${o}&mj_id=${b}&start_timestamp=${D}&end_timestamp=${W}`;const ee=await P.get(m),{success:j,message:K,data:ae}=ee.data;if(j)if(o===0)E(ae);else{let A=[...a];A.splice(o*Fe,ae.length,...ae),E(A)}else C(K);w(!1)},c=a.slice((d-1)*Fe,d*Fe),f=o=>{l(o),o===Math.ceil(a.length/Fe)+1&&B(o-1).then(m=>{})},v=async()=>{l(1),await B(0)},U=async o=>{await ze(o)?X("已复制："+o):ye.error({title:"无法复制到剪贴板，请手动复制",content:o})};return t.useEffect(()=>{v().then()},[_]),t.useEffect(()=>{localStorage.getItem("mj_notify_enabled")!=="true"&&H(!0)},[]),e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[I&&q?e.jsx(Ue,{type:"info",description:"当前未开启Midjourney回调，部分项目可能无法获得绘图结果，可在运营设置中开启。"}):e.jsx(e.Fragment,{}),e.jsx(N,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(N.Input,{field:"channel_id",label:"渠道 ID",style:{width:176},value:re,placeholder:"可选值",name:"channel_id",onChange:o=>R(o,"channel_id")}),e.jsx(N.Input,{field:"mj_id",label:"任务 ID",style:{width:176},value:b,placeholder:"可选值",name:"mj_id",onChange:o=>R(o,"mj_id")}),e.jsx(N.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:p,value:p,type:"dateTime",name:"start_timestamp",onChange:o=>R(o,"start_timestamp")}),e.jsx(N.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:g,value:g,type:"dateTime",name:"end_timestamp",onChange:o=>R(o,"end_timestamp")}),e.jsx(N.Section,{children:e.jsx(T,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:v,children:"查询"})})]})}),e.jsx(nu,{style:{marginTop:5},columns:r,dataSource:c,pagination:{currentPage:d,pageSize:Fe,total:F,pageSizeOpts:[10,20,50,100],onPageChange:f},loading:y}),e.jsx(ye,{visible:u,onOk:()=>n(!1),onCancel:()=>n(!1),closable:null,bodyStyle:{height:"400px",overflow:"auto"},width:800,children:e.jsx("p",{style:{whiteSpace:"pre-line"},children:i})}),e.jsx(tt,{src:te,visible:$,onVisibleChange:o=>S(o)})]})})},bs=()=>e.jsx(e.Fragment,{children:e.jsx(As,{})});function Ss(u){switch(u){case 1:return e.jsx(z,{color:"teal",size:"large",children:"按次计费"});case 0:return e.jsx(z,{color:"violet",size:"large",children:"按量计费"});default:return"未知"}}function ws(u){return u?e.jsx(du,{content:e.jsx("div",{style:{padding:8},children:"您的分组可以使用该模型"}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx($t,{style:{color:"green"},size:"large"})},u):e.jsx(du,{content:e.jsx("div",{style:{padding:8},children:"您的分组无权使用该模型"}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx(Rt,{style:{color:"#FFA54F"},size:"large"})},u)}const _s=()=>{const[u,n]=t.useState([]),i=t.useRef({isComposition:!1}),[s,r]=t.useState([]),[a,h]=t.useState(""),[y,w]=t.useState(!1),d=t.useMemo(()=>({onChange:(b,p)=>{r(b)}}),[]),l=b=>{if(i.current.isComposition)return;n(b?[b]:[])},F=()=>{i.current.isComposition=!0},x=b=>{i.current.isComposition=!1;const p=b.target.value;n(p?[p]:[])},_=[{title:"可用性",dataIndex:"available",render:(b,p,g)=>ws(b),sorter:(b,p)=>b.available-p.available},{title:e.jsxs(de,{children:[e.jsx("span",{children:"模型名称"}),e.jsx(le,{placeholder:"模糊搜索",style:{width:200},onCompositionStart:F,onCompositionEnd:x,onChange:l,showClear:!0})]}),dataIndex:"model_name",render:(b,p,g)=>e.jsx(e.Fragment,{children:e.jsx(z,{color:"green",size:"large",onClick:()=>{re(b)},children:b})}),onFilter:(b,p)=>p.model_name.toLowerCase().includes(b.toLowerCase()),filteredValue:u},{title:"计费类型",dataIndex:"quota_type",render:(b,p,g)=>Ss(parseInt(b)),sorter:(b,p)=>b.quota_type-p.quota_type},{title:()=>e.jsxs("span",{style:{display:"flex",alignItems:"center"},children:["倍率",e.jsx(du,{content:e.jsxs("div",{style:{padding:8},children:["倍率是为了方便换算不同价格的模型",e.jsx("br",{}),"点击查看倍率说明"]}),position:"top",style:{backgroundColor:"rgba(var(--semi-blue-4),1)",borderColor:"rgba(var(--semi-blue-4),1)",color:"var(--semi-color-white)",borderWidth:1,borderStyle:"solid"},children:e.jsx(nt,{onClick:()=>{h("/ratio.png"),w(!0)}})})]}),dataIndex:"model_ratio",render:(b,p,g)=>{let R=b,E=parseFloat(p.completion_ratio.toFixed(3));return R=e.jsxs(e.Fragment,{children:[e.jsxs(iu,{children:["模型：",p.quota_type===0?b:"无"]}),e.jsx("br",{}),e.jsxs(iu,{children:["补全：",p.quota_type===0?E:"无"]})]}),e.jsx("div",{children:R})}},{title:"模型价格",dataIndex:"model_price",render:(b,p,g)=>{let R=b;if(p.quota_type===0){let E=p.model_ratio*2*p.group_ratio,B=p.model_ratio*p.completion_ratio*2*p.group_ratio;R=e.jsxs(e.Fragment,{children:[e.jsxs(iu,{children:["提示 $",E," / 1M tokens"]}),e.jsx("br",{}),e.jsxs(iu,{children:["补全 $",B," / 1M tokens"]})]})}else{let E=parseFloat(b)*p.group_ratio;R=e.jsxs(e.Fragment,{children:["模型价格：$",E]})}return e.jsx("div",{children:R})}}],[M,I]=t.useState([]),[$,S]=t.useState(!0),[q,H]=t.useContext(Ze),[te,Y]=t.useState(1),Z=(b,p)=>{for(let g=0;g<b.length;g++)b[g].key=b[g].model_name,b[g].group_ratio=p;b.sort((g,R)=>g.quota_type-R.quota_type),b.sort((g,R)=>g.model_name.startsWith("gpt")&&!R.model_name.startsWith("gpt")?-1:!g.model_name.startsWith("gpt")&&R.model_name.startsWith("gpt")?1:g.model_name.localeCompare(R.model_name)),I(b)},L=async()=>{S(!0);let b="";b="/api/pricing";const p=await P.get(b),{success:g,message:R,data:E,group_ratio:B}=p.data;g?(Y(B),Z(E,B)):C(R),S(!1)},ne=async()=>{await L()},re=async b=>{await ze(b)?X("已复制："+b):ye.error({title:"无法复制到剪贴板，请手动复制",content:b})};return t.useEffect(()=>{ne().then()},[]),e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[q.user?e.jsx(Ue,{type:"success",fullMode:!1,closeIcon:"null",description:`您的分组为：${q.user.group}，分组倍率为：${te}`}):e.jsx(Ue,{type:"warning",fullMode:!1,closeIcon:"null",description:`您还未登陆，显示的价格为默认分组倍率: ${te}`}),e.jsx("br",{}),e.jsx(Ue,{type:"info",fullMode:!1,description:e.jsx("div",{children:"按量计费费用 = 分组倍率 × 模型倍率 × （提示token数 + 补全token数 × 补全倍率）/ 500000 （单位：美元）"}),closeIcon:"null"}),e.jsx("br",{}),e.jsx(T,{theme:"light",type:"tertiary",style:{width:150},onClick:()=>{re(s)},disabled:s=="",children:"复制选中模型"}),e.jsx(nu,{style:{marginTop:5},columns:_,dataSource:M,loading:$,pagination:{pageSize:M.length,showSizeChanger:!1},rowSelection:d}),e.jsx(tt,{src:a,visible:y,onVisibleChange:b=>w(b)})]})})},vs=()=>e.jsx(e.Fragment,{children:e.jsx(_s,{})}),ks=t.lazy(()=>Nu(()=>import("./index-Bx4vd2Fq.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ts=t.lazy(()=>Nu(()=>import("./index-CMNanNip.js"),__vite__mapDeps([7,1,8,2,3,4,5,6]))),Is=t.lazy(()=>Nu(()=>import("./index-Cvi4v8_m.js"),__vite__mapDeps([9,1,4,2,3,5,6])));function Ps(){const[u,n]=t.useContext(Ze),i=()=>{let s=localStorage.getItem("user");if(s){let r=JSON.parse(s);n({type:"login",payload:r})}};return t.useEffect(()=>{i();let s=wu();s&&(document.title=s);let r=gu();if(r){let a=document.querySelector("link[rel~='icon']");a&&(a.href=r)}},[]),e.jsx(ce,{children:e.jsx(ce.Content,{children:e.jsxs(wt,{children:[e.jsx(ge,{path:"/",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(ks,{})})}),e.jsx(ge,{path:"/channel",element:e.jsx(We,{children:e.jsx(ts,{})})}),e.jsx(ge,{path:"/channel/edit/:id",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Ru,{})})}),e.jsx(ge,{path:"/channel/add",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Ru,{})})}),e.jsx(ge,{path:"/token",element:e.jsx(We,{children:e.jsx(rs,{})})}),e.jsx(ge,{path:"/redemption",element:e.jsx(We,{children:e.jsx(ds,{})})}),e.jsx(ge,{path:"/user",element:e.jsx(We,{children:e.jsx(fn,{})})}),e.jsx(ge,{path:"/user/edit/:id",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx($u,{})})}),e.jsx(ge,{path:"/user/edit",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx($u,{})})}),e.jsx(ge,{path:"/user/reset",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Jn,{})})}),e.jsx(ge,{path:"/login",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(_n,{})})}),e.jsx(ge,{path:"/register",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(jn,{})})}),e.jsx(ge,{path:"/reset",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Vn,{})})}),e.jsx(ge,{path:"/oauth/github",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Qn,{})})}),e.jsx(ge,{path:"/setting",element:e.jsx(We,{children:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(qn,{})})})}),e.jsx(ge,{path:"/topup",element:e.jsx(We,{children:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(hs,{})})})}),e.jsx(ge,{path:"/log",element:e.jsx(We,{children:e.jsx(Es,{})})}),e.jsx(ge,{path:"/detail",element:e.jsx(We,{children:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Ts,{})})})}),e.jsx(ge,{path:"/midjourney",element:e.jsx(We,{children:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(bs,{})})})}),e.jsx(ge,{path:"/pricing",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(vs,{})})}),e.jsx(ge,{path:"/about",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Is,{})})}),e.jsx(ge,{path:"/chat",element:e.jsx(t.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Cs,{})})}),e.jsx(ge,{path:"*",element:e.jsx(vn,{})})]})})})}localStorage.getItem("chat_link");const Ms=()=>{const[u,n]=t.useContext(Ze);let i=Re();const[s,r]=t.useState(!1);wu(),gu();const a=new Date,h=a.getMonth()===0&&a.getDate()===1||a.getMonth()===1&&a.getDate()>=9&&a.getDate()<=24;async function y(){r(!1),await P.get("/api/user/logout"),X("注销成功!"),n({type:"logout"}),localStorage.removeItem("user"),i("/login")}const w=()=>{vu.init("root",{}),vu.start(),setTimeout(()=>{vu.stop(),setTimeout(()=>{window.location.reload()},1e4)},3e3)},d=gt(),l=kn();return t.useEffect(()=>{d==="dark"&&document.body.setAttribute("theme-mode","dark"),h&&console.log("Happy New Year!")},[]),e.jsx(e.Fragment,{children:e.jsx(ce,{children:e.jsx("div",{style:{width:"100%"},children:e.jsx(eu,{mode:"horizontal",renderWrapper:({itemElement:F,isSubNav:x,isInSubNav:_,props:M})=>{const I={about:"/about",login:"/login",register:"/register"};return e.jsx(cu,{style:{textDecoration:"none"},to:I[M.itemKey],children:F})},selectedKeys:[],onSelect:F=>{},footer:e.jsxs(e.Fragment,{children:[h&&e.jsx(Ve,{position:"bottomRight",render:e.jsx(Ve.Menu,{children:e.jsx(Ve.Item,{onClick:w,children:"Happy New Year!!!"})}),children:e.jsx(eu.Item,{itemKey:"new-year",text:"🏮"})}),e.jsx(eu.Item,{itemKey:"about",icon:e.jsx(nt,{})}),e.jsx(Iu,{checkedText:"🌞",size:"large",checked:d==="dark",uncheckedText:"🌙",onChange:F=>{l(F)}}),u.user?e.jsx(e.Fragment,{children:e.jsxs(Ve,{position:"bottomRight",render:e.jsx(Ve.Menu,{children:e.jsx(Ve.Item,{onClick:y,children:"退出"})}),children:[e.jsx(zu,{size:"small",color:Fu(u.user.username),style:{margin:4},children:u.user.username[0]}),e.jsx("span",{children:u.user.username})]})}):e.jsxs(e.Fragment,{children:[e.jsx(eu.Item,{itemKey:"login",text:"登录",icon:e.jsx(st,{})}),e.jsx(eu.Item,{itemKey:"register",text:"注册",icon:e.jsx(at,{})})]})]})})})})})};var $s={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Rs=()=>{wu();const[u,n]=t.useState(cn());let i=5;const s=()=>{let a=localStorage.getItem("footer_html");a&&n(a)},r=e.jsxs("div",{className:"custom-footer",children:[e.jsxs("a",{href:"https://github.com/Calcium-Ion/new-api",target:"_blank",rel:"noreferrer",children:["New API ",$s.VITE_REACT_APP_VERSION," "]}),"由"," ",e.jsx("a",{href:"https://github.com/Calcium-Ion",target:"_blank",rel:"noreferrer",children:"Calcium-Ion"})," ","开发，基于"," ",e.jsx("a",{href:"https://github.com/songquanpeng/one-api",target:"_blank",rel:"noreferrer",children:"One API"})]});return t.useEffect(()=>{const a=setInterval(()=>{if(i<=0){clearInterval(a);return}i--,s()},200);return()=>clearTimeout(a)},[]),e.jsx(ce,{children:e.jsx(ce.Content,{style:{textAlign:"center"},children:u?e.jsx($e,{content:r,children:e.jsx("div",{className:"custom-footer",dangerouslySetInnerHTML:{__html:u}})}):r})})},Os=(u,n)=>{switch(n.type){case"set":return{...u,status:n.payload};case"unset":return{...u,status:void 0};default:return u}},Ct={status:void 0},ft=pu.createContext({state:Ct,dispatch:()=>null}),zs=({children:u})=>{const[n,i]=pu.useReducer(Os,Ct);return e.jsx(ft.Provider,{value:[n,i],children:u})},Ls=()=>{t.useContext(Ze);const[u,n]=t.useContext(ft),i=ke()||localStorage.getItem("default_collapse_sidebar")==="true";Re();const[s,r]=t.useState(["home"]),a=wu(),h=gu(),[y,w]=t.useState(i),d={home:"/",channel:"/channel",token:"/token",redemption:"/redemption",topup:"/topup",user:"/user",log:"/log",midjourney:"/midjourney",setting:"/setting",about:"/about",chat:"/chat",detail:"/detail",pricing:"/pricing"},l=t.useMemo(()=>[{text:"首页",itemKey:"home",to:"/",icon:e.jsx(Ot,{})},{text:"渠道",itemKey:"channel",to:"/channel",icon:e.jsx(zt,{}),className:Ie()?"semi-navigation-item-normal":"tableHiddle"},{text:"聊天",itemKey:"chat",to:"/chat",icon:e.jsx(Lt,{}),className:localStorage.getItem("chat_link")?"semi-navigation-item-normal":"tableHiddle"},{text:"令牌",itemKey:"token",to:"/token",icon:e.jsx(st,{})},{text:"兑换码",itemKey:"redemption",to:"/redemption",icon:e.jsx(Nt,{}),className:Ie()?"semi-navigation-item-normal":"tableHiddle"},{text:"钱包",itemKey:"topup",to:"/topup",icon:e.jsx(Wt,{})},{text:"模型价格",itemKey:"pricing",to:"/pricing",icon:e.jsx(Ut,{})},{text:"用户管理",itemKey:"user",to:"/user",icon:e.jsx(at,{}),className:Ie()?"semi-navigation-item-normal":"tableHiddle"},{text:"日志",itemKey:"log",to:"/log",icon:e.jsx(Kt,{})},{text:"数据看板",itemKey:"detail",to:"/detail",icon:e.jsx(Gt,{}),className:localStorage.getItem("enable_data_export")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"绘图",itemKey:"midjourney",to:"/midjourney",icon:e.jsx(Ht,{}),className:localStorage.getItem("enable_drawing")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"设置",itemKey:"setting",to:"/setting",icon:e.jsx(qt,{})}],[localStorage.getItem("enable_data_export"),localStorage.getItem("enable_drawing"),localStorage.getItem("chat_link"),Ie()]),F=async()=>{const x=await P.get("/api/status");if(x===void 0)return;const{success:_,data:M}=x.data;_?(n({type:"set",payload:M}),Sn(M)):C("无法正常连接至服务器！")};return t.useEffect(()=>{F().then(()=>{w(ke()||localStorage.getItem("default_collapse_sidebar")==="true")});let x=window.location.pathname.split("/")[1];x===""&&(x="home"),r([x])},[]),e.jsx(e.Fragment,{children:e.jsx(ce,{children:e.jsx("div",{style:{height:"100%"},children:e.jsx(eu,{style:{maxWidth:200},defaultIsCollapsed:ke()||localStorage.getItem("default_collapse_sidebar")==="true",isCollapsed:y,onCollapseChange:x=>{w(x)},selectedKeys:s,renderWrapper:({itemElement:x,isSubNav:_,isInSubNav:M,props:I})=>e.jsx(cu,{style:{textDecoration:"none"},to:d[I.itemKey],children:x}),items:l,onSelect:x=>{r([x.itemKey])},header:{logo:e.jsx("img",{src:h,alt:"logo",style:{marginRight:"0.75em"}}),text:a},children:e.jsx(eu.Footer,{collapseButton:!0})})})})})},Ns=Mu.createRoot(document.getElementById("root")),{Sider:Ws,Content:Us,Header:Ks}=ce;Ns.render(e.jsx(pu.StrictMode,{children:e.jsx(zs,{children:e.jsx(Dn,{children:e.jsx(_t,{children:e.jsx(Tn,{children:e.jsxs(ce,{children:[e.jsx(Ws,{children:e.jsx(Ls,{})}),e.jsxs(ce,{children:[e.jsx(Ks,{children:e.jsx(Ms,{})}),e.jsx(Us,{style:{padding:"24px"},children:e.jsx(Ps,{})}),e.jsx(ce.Footer,{children:e.jsx(Rs,{})})]}),e.jsx(Jt,{})]})})})})})}));export{P as A,ft as S,C as a,Au as b,Js as c,xe as d,Zs as g,Ie as i,e as j,Xs as m,Ys as r,Gu as s,Le as t};
